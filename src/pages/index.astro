---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from 'astro:content';
import PostCard from '../components/PostCard.astro';
import SearchBox from '../components/SearchBox.astro';
import readingTime from '../utils/readingTime';
import { SITE } from '../config/site';

const all = (await getCollection('posts'))
  .map(p => ({ ...p, readingTime: readingTime(p.body) }))
  .sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
const posts = all.slice(0, SITE.postsPerPage);
const totalPages = Math.ceil(all.length / SITE.postsPerPage);
---
<BaseLayout title="Dev|Journal" description="Blogging about interests." canonical="/" structuredData={{
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Dev|Journal',
  url: 'https://earezki.com/'
}}>
  <SearchBox containerId="home" />
  
  <section class="posts-grid">
    {posts.map(p => <PostCard post={p} />)}
  </section>
  
  {totalPages > 1 && (
    <nav class="pagination" aria-label="Pagination">
      <a href="/page/2/" class="next">Older â†’</a>
    </nav>
  )}
</BaseLayout>

<style>
  .pagination { display:flex; justify-content:flex-end; margin:2.5rem 0 1rem; font-size:.9rem; }
  .pagination a { padding:.55rem 1rem; background:var(--color-bg-alt); border:1px solid var(--color-border); border-radius: var(--radius-pill); }
  .pagination a:hover { background:var(--color-accent); color:#fff; border-color:var(--color-accent); }
</style>
