---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from 'astro:content';
import PostCard from '../components/PostCard.astro';
import readingTime from '../utils/readingTime';
import { SITE } from '../config/site';

const all = (await getCollection('posts'))
  .map(p => ({ ...p, readingTime: readingTime(p.body) }))
  .sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
const posts = all.slice(0, SITE.postsPerPage);
const totalPages = Math.ceil(all.length / SITE.postsPerPage);
---
<BaseLayout title="Dev|Journal" description="Blogging about interests." canonical="/" structuredData={{
  '@context': 'https://schema.org',
  '@type': 'WebSite',
  name: 'Dev|Journal',
  url: 'https://earezki.com/'
}}>
  <section class="posts-grid">
    {posts.map(p => <PostCard post={p} />)}
  </section>
  {totalPages > 1 && <div class="more-posts"><a class="next" href="/page/2/">Older posts â†’</a></div>}
</BaseLayout>

<style>
  .more-posts { margin:2.5rem 0 1rem; text-align:center; }
  .more-posts a { padding:.65rem 1.25rem; background:var(--color-bg-alt); border:1px solid var(--color-border); border-radius: var(--radius-pill); }
  .more-posts a:hover { background:var(--color-accent); color:#fff; border-color:var(--color-accent); }
</style>
