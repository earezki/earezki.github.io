---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getCollection } from 'astro:content';
import PostCard from '../components/PostCard.astro';
import SearchBox from '../components/SearchBox.astro';
import readingTime from '../utils/readingTime';
import { SITE } from '../config/site';

const all = (await getCollection('posts'))
  .map(p => ({ ...p, readingTime: readingTime(p.body) }))
  .sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
const posts = all.slice(0, SITE.postsPerPage);
const totalPages = Math.ceil(all.length / SITE.postsPerPage);
---
<BaseLayout 
  title="Dev|Journal - Software Architecture, Backend Development & Technical Insights" 
  description="Technical blog by El Mehdi Arezki - Lead Software Engineer. In-depth articles on software architecture, microservices, domain-driven design, Java, Python, and cloud-native development."
  keywords="software architecture, backend development, microservices, domain-driven design, DDD, Java, Python, Spring Boot, Kubernetes, cloud native, technical blog"
  author="El Mehdi Arezki"
  canonical="/" 
  image="/assets/og-image-default.jpg"
  structuredData={{
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    name: 'Dev|Journal',
    url: 'https://earezki.com/',
    author: {
      '@type': 'Person',
      name: 'El Mehdi Arezki',
      url: 'https://earezki.com/about',
      jobTitle: 'Lead Software Engineer',
      sameAs: [
        'https://github.com/earezki',
        'https://www.linkedin.com/in/mehdi-arezki'
      ]
    },
    description: 'Technical blog covering software architecture, backend development, and engineering best practices'
  }}>
  
  <h1 class="sr-only">Dev|Journal - Software Architecture & Backend Development Blog</h1>
  
  <SearchBox containerId="home" />
  
  <section class="posts-grid">
    {posts.map(p => <PostCard post={p} />)}
  </section>
  
  {totalPages > 1 && (
    <nav class="pagination" aria-label="Pagination">
      <a href="/page/2/" class="next">Older â†’</a>
    </nav>
  )}
</BaseLayout>

<style>
  .pagination { display:flex; justify-content:flex-end; margin:2.5rem 0 1rem; font-size:.9rem; }
  .pagination a { padding:.55rem 1rem; background:var(--color-bg-alt); border:1px solid var(--color-border); border-radius: var(--radius-pill); }
  .pagination a:hover { background:var(--color-accent); color:#fff; border-color:var(--color-accent); }
</style>
