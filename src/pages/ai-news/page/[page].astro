---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import { getCollection } from 'astro:content';
import PostCard from '../../../components/PostCard.astro';
import SearchBox from '../../../components/SearchBox.astro';
import readingTime from '../../../utils/readingTime';
import { SITE } from '../../../config/site';

export async function getStaticPaths() {
  const posts = await getCollection('ainews');
  const totalPages = Math.ceil(posts.length / SITE.postsPerPage);
  return Array.from({length: totalPages}, (_,i) => ({ params: { page: String(i+1) }, props: { page: i+1, totalPages } }));
}

const { page, totalPages } = Astro.props as { page: number; totalPages: number };
const all = (await getCollection('ainews'))
  .map(p => ({ ...p, readingTime: readingTime(p.body) }))
  .sort((a,b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());
const start = (page - 1) * SITE.postsPerPage;
const posts = all.slice(start, start + SITE.postsPerPage);
---
<BaseLayout title={`AI News - Page ${page} • Dev|Journal`} canonical={`/ai-news/page/${page}/`} description={`AI News page ${page} of ${totalPages}`}>
  <h1 style="margin-bottom:1rem;">AI News – Page {page}</h1>
  
  <div class="ai-disclaimer">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="flex-shrink: 0;">
      <circle cx="12" cy="12" r="10"></circle>
      <line x1="12" y1="8" x2="12" y2="12"></line>
      <line x1="12" y1="16" x2="12.01" y2="16"></line>
    </svg>
    <div>
      <strong>AI-Generated Content:</strong> Articles in this section are created with AI assistance. Please verify important information and check original references before relying on the content.
    </div>
  </div>

  <SearchBox containerId={`ai-news-page-${page}`} />

  <section class="posts-grid">
    {posts.map(p => <PostCard post={p} collection="ainews" />)}
  </section>
  
  <nav class="pagination" aria-label="Pagination">
    {page > 1 && <a href={page === 2 ? '/ai-news/' : `/ai-news/page/${page-1}/`} class="prev">← Newer</a>}
    {page < totalPages && <a href={`/ai-news/page/${page+1}/`} class="next">Older →</a>}
  </nav>
</BaseLayout>

<style>
  .ai-disclaimer {
    display: flex;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    margin-bottom: 2rem;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1), rgba(240, 147, 251, 0.1));
    border: 2px solid transparent;
    border-radius: var(--radius-md);
    position: relative;
    background-clip: padding-box;
  }
  
  .ai-disclaimer::before {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: var(--radius-md);
    padding: 2px;
    background: var(--ai-gradient-border);
    background-size: 200% 200%;
    animation: gradient-rotate 3s linear infinite;
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: exclude;
    pointer-events: none;
  }
  
  html[data-theme="dark"] .ai-disclaimer {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.15), rgba(118, 75, 162, 0.15), rgba(240, 147, 251, 0.15));
  }
  
  .ai-disclaimer svg {
    margin-top: 0.15rem;
  }
  
  .ai-disclaimer strong {
    color: var(--color-text);
    display: block;
    margin-bottom: 0.25rem;
  }
  
  .ai-disclaimer div {
    font-size: 0.9rem;
    line-height: 1.5;
    color: var(--color-text-alt);
  }

  .pagination { 
    display: flex; 
    justify-content: space-between; 
    margin: 2.5rem 0 1rem; 
    font-size: 0.9rem; 
  }
  
  .pagination a { 
    padding: 0.55rem 1rem; 
    background: var(--color-bg-alt); 
    border: 1px solid var(--color-border); 
    border-radius: var(--radius-pill); 
  }
  
  .pagination a:hover { 
    background: var(--color-accent); 
    color: #fff; 
    border-color: var(--color-accent); 
  }
</style>
