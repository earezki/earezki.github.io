<!DOCTYPE html><html lang="en" data-theme="dark"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Hexagonal Architecture: Why Your Domain Logic Shouldn&#39;t Know About Your Database ‚Ä¢ Dev|Journal</title><meta name="description" content="TL;DR Hexagonal Architecture (Ports &#38; Adapters) inverts the traditional layered approach by putting your domain logic at the center and making everything else,‚Ä¶"><meta name="keywords" content="Software architecture, Software design, Domain-Driven Design"><meta name="author" content="El Mehdi Arezki"><meta property="og:type" content="website"><meta property="og:url" content="https://earezki.com/hexagonal-architecture/"><meta property="og:title" content="Hexagonal Architecture: Why Your Domain Logic Shouldn't Know About Your Database ‚Ä¢ Dev|Journal"><meta property="og:site_name" content="Dev|Journal"><meta property="og:description" content="TL;DR Hexagonal Architecture (Ports &#38; Adapters) inverts the traditional layered approach by putting your domain logic at the center and making everything else,‚Ä¶"><meta property="og:image" content="https://earezki.com/assets/og-image-default.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://earezki.com/hexagonal-architecture/"><meta name="twitter:title" content="Hexagonal Architecture: Why Your Domain Logic Shouldn't Know About Your Database ‚Ä¢ Dev|Journal"><meta name="twitter:description" content="TL;DR Hexagonal Architecture (Ports &#38; Adapters) inverts the traditional layered approach by putting your domain logic at the center and making everything else,‚Ä¶"><meta name="twitter:image" content="https://earezki.com/assets/og-image-default.jpg"><meta name="twitter:creator" content="@earezki"><link rel="canonical" href="https://earezki.com/hexagonal-architecture/"><link rel="icon" type="image/png" href="/assets/favicon_48_d.webp"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="dns-prefetch" href="https://cloud.umami.is"><script defer src="https://cloud.umami.is/script.js" data-website-id="4a26531d-1053-4f79-97a6-06a1366aff91"></script><script>
      (function() {
        const theme = localStorage.getItem('theme');
        if (theme) document.documentElement.setAttribute('data-theme', theme);
      })();
    </script><script>
!function(){const o=window.location.pathname;if("/"===o)return;if(/\.\w+$/.test(o))return;const n=o.toLowerCase(),i=n!==o,t=!o.endsWith("/");if(i||t){const o=n+(t?"/":""),i=window.location.origin+o+window.location.search+window.location.hash;window.location.replace(i)}}();
</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hexagonal Architecture: Why Your Domain Logic Shouldn't Know About Your Database","description":"TL;DR Hexagonal Architecture (Ports & Adapters) inverts the traditional layered approach by putting your domain logic at the center and making everything else,‚Ä¶","image":"https://earezki.com/assets/og-image-default.jpg","datePublished":"2020-03-29T00:00:00.000Z","dateModified":"2020-03-29T00:00:00.000Z","author":{"@type":"Person","name":"El Mehdi Arezki","url":"https://earezki.com/about","jobTitle":"Lead Software Engineer","sameAs":["https://github.com/earezki","https://www.linkedin.com/in/mehdi-arezki"]},"publisher":{"@type":"Organization","name":"Dev|Journal","url":"https://earezki.com","logo":{"@type":"ImageObject","url":"https://earezki.com/assets/logo.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://earezki.com/hexagonal-architecture/"}}</script><link rel="stylesheet" href="/_astro/_slug_.B_eXuGWa.css">
<link rel="stylesheet" href="/_astro/_slug_.CFj9bTVJ.css">
<link rel="stylesheet" href="/_astro/_slug_.BuIxISHP.css"></head> <body> <div id="readingProgress" role="progressbar" aria-label="Reading progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="position:fixed;left:0;top:0;height:3px;background:linear-gradient(90deg,#2563eb,#9333ea);width:0;z-index:999;transition:width .15s ease;"></div> <script type="module">function c(){const t=document.getElementById("readingProgress");if(!t)return;const o=()=>{const e=document.documentElement,r=e.scrollTop||document.body.scrollTop,s=e.scrollHeight-e.clientHeight,n=s>0?r/s*100:0;t.style.width=`${n}%`,t.setAttribute("aria-valuenow",n.toFixed(0))};document.addEventListener("scroll",o,{passive:!0}),o()}c();</script> <header class="site-header container"> <div class="logo-wrap"> <a class="logo" href="/" aria-label="Dev|Journal Home">
Dev|Journal
</a> </div> <!-- Search Box in Header --> <div class="header-search" data-search-api-url="https://api.earezki.com/blog/api/q" data-search-timeout="2000"> <div class="search-box" id="search-box"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon" aria-hidden="true"> <circle cx="11" cy="11" r="8"></circle> <path d="m21 21-4.35-4.35"></path> </svg> <input type="text" id="search-input" placeholder="Search ..." class="search-input" autocomplete="off" aria-label="Search articles" minlength="3"> <button id="clear-search" class="clear-button" style="display: none;" aria-label="Clear search"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg> </button> </div> <div id="search-results" class="search-results" role="status" aria-live="polite"></div> </div> <script type="module" src="/_astro/SearchBox.astro_astro_type_script_index_0_lang.BNnBPVSN.js"></script> <nav class="main-nav" aria-label="Main navigation"> <a href="/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path> <polyline points="9 22 9 12 15 12 15 22"></polyline> </svg>
Home
</a> <a href="/ai-news/" class="ai-news-link ai-gradient-nav"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h-9.5a.5.5 0 0 0-.5.5.5.5 0 0 1-1 0 .5.5 0 0 0-.5-.5H1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path> <path d="M7 15v4a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-4"></path> </svg>
AI News
</a> <a href="/ai-financial-news/" class="ai-financial-link ai-gradient-nav"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <line x1="12" y1="1" x2="12" y2="23"></line> <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path> </svg>
AI Financial
</a> <a href="/about/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <circle cx="12" cy="12" r="10"></circle> <path d="M12 16v-4"></path> <path d="M12 8h.01"></path> </svg>
About
</a> <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode"> <span class="theme-icon" aria-hidden="true">‚òæ</span> </button> </nav> </header> <!-- Main Content --> <main class="container content-area">  <nav class="breadcrumbs" aria-label="Breadcrumb" data-astro-cid-ilhxcym7> <ol data-astro-cid-ilhxcym7> <li data-astro-cid-ilhxcym7>  <a href="/" data-astro-cid-ilhxcym7>Home</a> <span class="separator" aria-hidden="true" data-astro-cid-ilhxcym7>/</span>  </li><li data-astro-cid-ilhxcym7> <span class="current" aria-current="page" data-astro-cid-ilhxcym7>Hexagonal Architecture: Why Your Domain Logic Shouldn&#39;t Know About Your Database</span> </li>  </ol> </nav>  <div class="post-layout" data-astro-cid-yvbahnfj> <aside class="sidebar-left" data-astro-cid-yvbahnfj> <nav class="toc" aria-label="Table of Contents" data-astro-cid-xvrfupwn> <div class="toc-title" data-astro-cid-xvrfupwn>On this page</div> <ul data-astro-cid-xvrfupwn> <li class="d-2" data-astro-cid-xvrfupwn> <a href="#tldr" data-astro-cid-xvrfupwn> TL;DR </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#the-problem-with-traditional-layered-architecture" data-astro-cid-xvrfupwn> The Problem with Traditional Layered Architecture </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#dependency-injection-changed-everything-quietly" data-astro-cid-xvrfupwn> Dependency Injection Changed Everything (Quietly) </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#how-hexagonal-architecture-actually-works" data-astro-cid-xvrfupwn> How Hexagonal Architecture Actually Works </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#inner-layer-domain-the-hexagon" data-astro-cid-xvrfupwn> Inner Layer: Domain (The Hexagon) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#outer-layer-adapters" data-astro-cid-xvrfupwn> Outer Layer: Adapters </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#the-crucial-difference" data-astro-cid-xvrfupwn> The Crucial Difference </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#why-this-matters-in-practice" data-astro-cid-xvrfupwn> Why This Matters in Practice </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#1-testing-becomes-trivial" data-astro-cid-xvrfupwn> 1. Testing Becomes Trivial </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#2-technology-decisions-are-deferred-and-reversible" data-astro-cid-xvrfupwn> 2. Technology Decisions Are Deferred (and Reversible) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#3-multi-client-support-is-free" data-astro-cid-xvrfupwn> 3. Multi-Client Support Is Free </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#4-domain-events-decouple-naturally" data-astro-cid-xvrfupwn> 4. Domain Events Decouple Naturally </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#common-misconceptions" data-astro-cid-xvrfupwn> Common Misconceptions </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#when-to-use-this-and-when-not-to" data-astro-cid-xvrfupwn> When to Use This (and When Not To) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#use-hexagonal-architecture-when" data-astro-cid-xvrfupwn> Use Hexagonal Architecture when: </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#skip-it-when" data-astro-cid-xvrfupwn> Skip it when: </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#practical-example-order-processing" data-astro-cid-xvrfupwn> Practical Example: Order Processing </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#integration-with-domain-driven-design" data-astro-cid-xvrfupwn> Integration with Domain-Driven Design </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#key-takeaways" data-astro-cid-xvrfupwn> Key Takeaways </a> </li> </ul> </nav>  </aside> <article class="post" data-astro-cid-yvbahnfj> <header class="post-header" data-astro-cid-yvbahnfj> <h1 data-astro-cid-yvbahnfj>Hexagonal Architecture: Why Your Domain Logic Shouldn&#39;t Know About Your Database</h1> <div class="meta" data-astro-cid-yvbahnfj> <time datetime="2020-03-29T00:00:00.000Z" data-astro-cid-yvbahnfj>Sun Mar 29 2020</time> <span data-astro-cid-yvbahnfj>‚Ä¢ 6 min read</span> </div> <div class="tag-row" data-astro-cid-yvbahnfj><a class="post-tag  " href="/tags/software-architecture/" data-astro-cid-yvbahnfj>Software architecture</a><a class="post-tag  " href="/tags/software-design/" data-astro-cid-yvbahnfj>Software design</a><a class="post-tag  " href="/tags/domain-driven-design/" data-astro-cid-yvbahnfj>Domain-Driven Design</a></div> </header>     <div class="post-body prose" data-astro-cid-yvbahnfj> <h2 id="tldr">TL;DR</h2>
<p>Hexagonal Architecture (Ports &#x26; Adapters) inverts the traditional layered approach by putting your domain logic at the center and making everything else, databases, APIs, message queues, pluggable through interfaces. Your business rules expose ports (interfaces), and infrastructure provides adapters (implementations). This means you can test your core logic with in-memory implementations, swap PostgreSQL for DynamoDB without touching domain code, and support REST, GraphQL, or gRPC clients without architecture gymnastics. If you‚Äôre using dependency injection already, you‚Äôre halfway there without knowing it.</p>
<h2 id="the-problem-with-traditional-layered-architecture">The Problem with Traditional Layered Architecture</h2>
<p>Most codebases start with the classic three-tier stack: Presentation ‚Üí Domain ‚Üí Infrastructure. Dependencies flow downward like a waterfall. Your UI depends on your service layer, your service layer depends on your repository, and your repository depends on whatever ORM or database client you picked on day one.</p>
<p><img src="/assets/layered_architecture.webp" alt="Layered Architecture" title="Layered Architecture"></p>
<p>This creates a coupling nightmare. Want to test business logic? Better spin up a database or write elaborate mocks. Want to switch from MySQL to MongoDB? Hope you didn‚Äôt leak SQL queries into your domain. Need to support both REST and gRPC? Prepare for a refactoring spree.</p>
<p>The real issue: <strong>your infrastructure choices constrain your domain model</strong>. Your business rules shouldn‚Äôt care whether data lives in Postgres, Redis, or a JSON file. But in layered architecture, they do, because the domain layer directly depends on the infrastructure layer.</p>
<h2 id="dependency-injection-changed-everything-quietly">Dependency Injection Changed Everything (Quietly)</h2>
<p>Here‚Äôs what actually happened in most modern codebases: teams claimed they were doing layered architecture, but dependency injection frameworks like Spring, ASP.NET Core, or even manual DI containers inverted the control flow.</p>
<p>Instead of:</p>
<pre class="language-java" data-language="java"><code is:raw="" class="language-java"><span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">OrderRepository</span> repo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PostgresOrderRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>We started doing:</p>
<pre class="language-java" data-language="java"><code is:raw="" class="language-java"><span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">OrderRepository</span> repo<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">OrderService</span><span class="token punctuation">(</span><span class="token class-name">OrderRepository</span> repo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>repo <span class="token operator">=</span> repo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Suddenly, the domain doesn‚Äôt depend on infrastructure anymore, it depends on an <strong>interface</strong>. The wiring happens at the edges, in your composition root. You‚Äôve been doing a flavor of Hexagonal Architecture without calling it that.</p>
<h2 id="how-hexagonal-architecture-actually-works">How Hexagonal Architecture Actually Works</h2>
<p>The core idea: organize your system in layers where <strong>dependencies point inward</strong>.</p>
<p><img src="/assets/Hexagonal_Architecture.webp" alt="Hexagonal Architecture" title="Hexagonal Architecture"></p>
<h3 id="inner-layer-domain-the-hexagon">Inner Layer: Domain (The Hexagon)</h3>
<p>This is your business logic, use cases, entities, domain events, the stuff that would exist even if you rewrote the entire stack in a different language. It exposes <strong>ports</strong>: interfaces that define what the domain needs from the outside world.</p>
<p>Example ports:</p>
<ul>
<li><code>OrderRepository</code> (persistence)</li>
<li><code>PaymentGateway</code> (external service)</li>
<li><code>EventPublisher</code> (messaging)</li>
<li><code>EmailService</code> (notifications)</li>
</ul>
<p>The domain <strong>declares</strong> these interfaces but <strong>never implements</strong> them. That‚Äôs the outer layer‚Äôs job.</p>
<h3 id="outer-layer-adapters">Outer Layer: Adapters</h3>
<p>Adapters implement the ports. You can have multiple adapters for the same port:</p>
<ul>
<li><code>PostgresOrderRepository</code> and <code>InMemoryOrderRepository</code> both implement <code>OrderRepository</code></li>
<li><code>StripePaymentGateway</code> and <code>MockPaymentGateway</code> both implement <code>PaymentGateway</code></li>
<li><code>RabbitMQEventPublisher</code> and <code>SyncEventPublisher</code> both implement <code>EventPublisher</code></li>
</ul>
<p>Adapters also handle <strong>incoming requests</strong>: REST controllers, GraphQL resolvers, CLI commands, message queue consumers. Each client gets its own adapter that translates external protocols into domain operations.</p>
<h3 id="the-crucial-difference">The Crucial Difference</h3>
<p>In traditional layered architecture:</p>
<pre class="language-plaintext" data-language="plaintext"><code is:raw="" class="language-plaintext">UI ‚Üí Service (Domain) ‚Üí Repository (Infrastructure)
</code></pre>
<p>Domain depends on infrastructure.</p>
<p>In Hexagonal Architecture:</p>
<pre class="language-plaintext" data-language="plaintext"><code is:raw="" class="language-plaintext">UI Adapter ‚Üí Domain ‚Üê Infrastructure Adapter
         ‚Üì           ‚Üë
    Both depend on Domain's interfaces
</code></pre>
<p>Everything depends on the domain. Infrastructure and UI are implementation details.</p>
<h2 id="why-this-matters-in-practice">Why This Matters in Practice</h2>
<h3 id="1-testing-becomes-trivial">1. Testing Becomes Trivial</h3>
<p>Your domain logic tests don‚Äôt need Docker containers, test databases, or mocking frameworks. Just pass in-memory implementations:</p>
<pre class="language-java" data-language="java"><code is:raw="" class="language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">shouldApplyDiscountToOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> repo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InMemoryOrderRepository</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> service <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrderService</span><span class="token punctuation">(</span>repo<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">FakePaymentGateway</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">var</span> order <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">createOrder</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> items<span class="token punctuation">)</span><span class="token punctuation">;</span>
    service<span class="token punctuation">.</span><span class="token function">applyDiscount</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"SAVE20"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token number">80.0</span><span class="token punctuation">,</span> repo<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">totalPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>No <code>@SpringBootTest</code>, no database migrations, no fixture cleanup. Tests run in milliseconds.</p>
<h3 id="2-technology-decisions-are-deferred-and-reversible">2. Technology Decisions Are Deferred (and Reversible)</h3>
<p>Starting a new project? You can build and validate the entire domain model with in-memory adapters before choosing a database. When you finally pick Postgres (or Dynamo, or whatever), the domain code doesn‚Äôt change, you just wire in a different adapter.</p>
<p>Already in production? Migrating from MySQL to Cassandra means writing a new adapter and swapping the wiring. Zero changes to business logic.</p>
<h3 id="3-multi-client-support-is-free">3. Multi-Client Support Is Free</h3>
<p>Need to expose the same functionality via REST, GraphQL, and gRPC? Each gets its own adapter calling the same domain services. No duplication, no ‚ÄúAPI layer‚Äù vs ‚Äúinternal layer‚Äù split.</p>
<pre class="language-plaintext" data-language="plaintext"><code is:raw="" class="language-plaintext">RestOrderController  ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
GraphQLOrderResolver ‚îÄ‚îÄ‚îÄ‚îÄ‚î§‚îÄ‚îÄ‚Üí OrderService (Domain)
GrpcOrderService     ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</code></pre>
<h3 id="4-domain-events-decouple-naturally">4. Domain Events Decouple Naturally</h3>
<p>When an order is placed, the domain publishes an <code>OrderPlacedEvent</code> through the <code>EventPublisher</code> port. In production, that‚Äôs RabbitMQ. In tests, it‚Äôs a spy that captures events. In local dev, it‚Äôs synchronous in-memory dispatch.</p>
<p>The domain doesn‚Äôt know or care. It just publishes to an interface.</p>
<h2 id="common-misconceptions">Common Misconceptions</h2>
<p><strong>‚ÄúThis is just Clean Architecture / Onion Architecture‚Äù</strong><br>
Correct. They‚Äôre variations of the same dependency inversion principle. Hexagonal Architecture (2005) predates them, but the ideas converged. Use whichever name your team prefers.</p>
<p><strong>‚ÄúYou need a framework to do this‚Äù</strong><br>
No. You need discipline. Frameworks like Spring make wiring easier, but you can do this in plain Java, Go, Python, anything with interfaces or protocols.</p>
<p><strong>‚ÄúThis adds too much boilerplate‚Äù</strong><br>
Initially, yes. You write more interfaces. But when you add the third API client or swap databases for the second time, you‚Äôll wish you‚Äôd started with ports and adapters.</p>
<p><strong>‚ÄúThe hexagon shape is important‚Äù</strong><br>
It‚Äôs not. Alistair Cockburn used a hexagon to emphasize symmetry, no difference between ‚Äúinput‚Äù adapters (HTTP, CLI) and ‚Äúoutput‚Äù adapters (database, queue). The shape is a teaching aid, not a specification.</p>
<h2 id="when-to-use-this-and-when-not-to">When to Use This (and When Not To)</h2>
<h3 id="use-hexagonal-architecture-when">Use Hexagonal Architecture when:</h3>
<ul>
<li>You‚Äôre building software where business logic is non-trivial and will evolve</li>
<li>You need to support multiple clients (web, mobile API, batch jobs)</li>
<li>You want fast, isolated unit tests for your domain</li>
<li>You might change infrastructure (database, message broker) later</li>
<li>You‚Äôre doing Domain-Driven Design (this architecture is built for it)</li>
</ul>
<h3 id="skip-it-when">Skip it when:</h3>
<ul>
<li>You‚Äôre building a simple CRUD API with no real business logic</li>
<li>The entire app is a thin wrapper around database operations</li>
<li>You‚Äôre prototyping and will throw away the code in two weeks</li>
<li>Your team is junior and struggling with basic abstractions</li>
</ul>
<p>Don‚Äôt over-engineer. If your ‚Äúdomain‚Äù is just <code>user.save()</code> and <code>user.delete()</code>, layered architecture is fine.</p>
<h2 id="practical-example-order-processing">Practical Example: Order Processing</h2>
<pre class="language-java" data-language="java"><code is:raw="" class="language-java"><span class="token comment">// Domain Layer (Inner)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>
    <span class="token class-name">Order</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Order</span> order<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">Order</span><span class="token punctuation">></span></span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token class-name">OrderId</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PaymentGateway</span> <span class="token punctuation">{</span>
    <span class="token class-name">PaymentResult</span> <span class="token function">charge</span><span class="token punctuation">(</span><span class="token class-name">Amount</span> amount<span class="token punctuation">,</span> <span class="token class-name">PaymentMethod</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">OrderRepository</span> orders<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PaymentGateway</span> payments<span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token class-name">OrderService</span><span class="token punctuation">(</span><span class="token class-name">OrderRepository</span> orders<span class="token punctuation">,</span> <span class="token class-name">PaymentGateway</span> payments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>orders <span class="token operator">=</span> orders<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>payments <span class="token operator">=</span> payments<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">placeOrder</span><span class="token punctuation">(</span><span class="token class-name">UserId</span> userId<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">LineItem</span><span class="token punctuation">></span></span> items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> order <span class="token operator">=</span> <span class="token class-name">Order</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>userId<span class="token punctuation">,</span> items<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> result <span class="token operator">=</span> payments<span class="token punctuation">.</span><span class="token function">charge</span><span class="token punctuation">(</span>order<span class="token punctuation">.</span><span class="token function">total</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> order<span class="token punctuation">.</span><span class="token function">paymentMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            order<span class="token punctuation">.</span><span class="token function">markAsPaid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> orders<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">PaymentFailedException</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">errorCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Adapters Layer (Outer)</span>
<span class="token keyword">class</span> <span class="token class-name">PostgresOrderRepository</span> <span class="token keyword">implements</span> <span class="token class-name">OrderRepository</span> <span class="token punctuation">{</span>
    <span class="token comment">// JDBC/JPA implementation</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">StripePaymentGateway</span> <span class="token keyword">implements</span> <span class="token class-name">PaymentGateway</span> <span class="token punctuation">{</span>
    <span class="token comment">// Stripe API calls</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">RestOrderController</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">OrderService</span> service<span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">"/orders"</span><span class="token punctuation">)</span>
    <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&#x3C;</span><span class="token class-name">OrderDTO</span><span class="token punctuation">></span></span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">CreateOrderRequest</span> req<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> order <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">placeOrder</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span><span class="token function">userId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span><span class="token function">items</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">ok</span><span class="token punctuation">(</span><span class="token class-name">OrderDTO</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>OrderService</code> has no idea it‚Äôs talking to Postgres or Stripe. Swap in DynamoDB and PayPal by changing the wiring in your DI container, zero changes to <code>OrderService</code>.</p>
<h2 id="integration-with-domain-driven-design">Integration with Domain-Driven Design</h2>
<p>Hexagonal Architecture is practically mandatory if you‚Äôre doing DDD. Your <strong>bounded contexts</strong> map to hexagons, each with their own ports and adapters. Aggregates, entities, and value objects live in the inner layer. Repositories are ports. Anti-corruption layers are adapters that translate between contexts.</p>
<p>This is why the pattern has seen a resurgence, DDD + microservices + event-driven architectures all benefit from isolating domain logic from infrastructure chaos.</p>
<h2 id="key-takeaways">Key Takeaways</h2>
<ol>
<li>
<p><strong>Dependency direction matters more than layers.</strong> Always point inward toward the domain.</p>
</li>
<li>
<p><strong>Ports are interfaces your domain needs.</strong> Adapters are implementations the infrastructure provides.</p>
</li>
<li>
<p><strong>If you‚Äôre using DI, you‚Äôre already doing a version of this.</strong> Formalize it by being strict about dependency flow.</p>
</li>
<li>
<p><strong>Testing becomes embarrassingly simple</strong> when your domain has zero infrastructure dependencies.</p>
</li>
<li>
<p><strong>Design for use cases, not clients.</strong> The domain shouldn‚Äôt know whether it‚Äôs serving REST, GraphQL, or a CLI. That‚Äôs what adapters are for.</p>
</li>
<li>
<p><strong>Technology swaps are cheap</strong> when they‚Äôre just adapter rewrites. Your Postgres adapter is 200 lines. Your domain is 5,000 lines. Which would you rather rewrite?</p>
</li>
<li>
<p><strong>Don‚Äôt hexagon-ify CRUD apps.</strong> If your app is thin glue between a UI and a database, this is overkill.</p>
</li>
</ol> </div>  <section class="series-navigation" data-astro-cid-2hl7stop> <div class="series-header" data-astro-cid-2hl7stop> <span class="series-badge" data-astro-cid-2hl7stop>üìö Series</span> <h3 data-astro-cid-2hl7stop>Domain-Driven Design</h3> <p class="series-progress" data-astro-cid-2hl7stop>Part 3 of 3</p> </div> <div class="series-list" data-astro-cid-2hl7stop> <div class="series-item  completed" data-astro-cid-2hl7stop> <span class="series-number" data-astro-cid-2hl7stop>1</span> <a href="/domain-driven-design-core-concepts/" class="series-title" data-astro-cid-2hl7stop> Domain Driven Design Core Concepts </a> <span class="check-icon" title="Completed" data-astro-cid-2hl7stop>‚úì</span> </div><div class="series-item  completed" data-astro-cid-2hl7stop> <span class="series-number" data-astro-cid-2hl7stop>2</span> <a href="/anemic-vs-rich-domain-models/" class="series-title" data-astro-cid-2hl7stop> Anemic vs Rich Domain Models </a> <span class="check-icon" title="Completed" data-astro-cid-2hl7stop>‚úì</span> </div><div class="series-item current " data-astro-cid-2hl7stop> <span class="series-number" data-astro-cid-2hl7stop>3</span> <span class="series-title current-title" data-astro-cid-2hl7stop>Hexagonal Architecture: Why Your Domain Logic Shouldn&#39;t Know About Your Database</span>  </div> </div> <div class="series-nav-buttons" data-astro-cid-2hl7stop> <a href="/anemic-vs-rich-domain-models/" class="series-nav-btn prev" data-astro-cid-2hl7stop> <span class="nav-label" data-astro-cid-2hl7stop>‚Üê Previous</span> <span class="nav-title" data-astro-cid-2hl7stop>Anemic vs Rich Domain Models</span> </a>  </div> </section>   <section class="related-posts" data-astro-cid-dpgbfi7r> <h2 data-astro-cid-dpgbfi7r>Related Posts</h2> <div class="related-posts-grid" data-astro-cid-dpgbfi7r> <article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/massively-scaling-a-web-application/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>Massively scaling a web application</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>1. Single server setup 2. Vertical scaling 3. Horizontal scaling 4. Stateful-vs-stateless 5. Load balancer 6. Choice of‚Ä¶</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-11-02T00:00:00.000Z" data-astro-cid-dpgbfi7r> Nov 2, 2025 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>1 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/solid-principles/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>SOLID</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r></p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2024-07-25T00:00:00.000Z" data-astro-cid-dpgbfi7r> Jul 25, 2024 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>1 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/dependency-inversion-principle/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>D (Dependency Inversion) from SOLID</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>The Dependency Inversion Principle: Stop Depending on Details What Is Dependency Inversion, Really? Let me ask you a‚Ä¶</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2024-06-22T00:00:00.000Z" data-astro-cid-dpgbfi7r> Jun 22, 2024 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>14 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/interface-segregation-principle/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>I (Interface Segregation) from SOLID</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>The Interface Segregation Principle: Why Your Interfaces Are Probably Too Fat What Is Interface Segregation, Really?‚Ä¶</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2024-06-21T00:00:00.000Z" data-astro-cid-dpgbfi7r> Jun 21, 2024 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>17 min read</span> </div> </a> </article> </div> </section>  </article> </div> <div class="back-link" data-astro-cid-yvbahnfj><a href="/" data-astro-cid-yvbahnfj>‚Üê Back to home</a></div>  </main> <!-- Site Footer --> <footer class="site-footer container"> <p>
¬© 2025 AREZKI El Mehdi ‚Ä¢
<a href="https://github.com/earezki">GitHub</a> ‚Ä¢
<a href="/rss.xml">RSS</a> ‚Ä¢
<a href="/tags/">Tags</a> ‚Ä¢
<a href="/sitemap-index.xml">Sitemap</a> ‚Ä¢
<button id="footer-subscribe-btn" class="footer-subscribe-btn" aria-label="Subscribe to newsletter">
üì¨ Subscribe
</button> </p> </footer> <!-- Footer Subscribe Button Handler --> <script type="module">const e=document.getElementById("themeToggle"),o=n=>{if(!e)return;const t=e.querySelector(".theme-icon");t&&(t.textContent=n==="dark"?"‚òÄ":"‚òæ")};if(e){const n=document.documentElement.getAttribute("data-theme")||"dark";o(n),e.addEventListener("click",()=>{const t=document.documentElement,c=t.getAttribute("data-theme")==="dark"?"light":"dark";t.setAttribute("data-theme",c),localStorage.setItem("theme",c),o(c)})}</script> <!-- Theme Toggle --> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("footer-subscribe-btn");e&&e.addEventListener("click",n=>{n.preventDefault();const t=document.getElementById("subscription-popup");t&&(t.setAttribute("data-state","visible"),document.body.style.overflow="hidden")})});</script> <!-- Article read/unread tracking --> <script>
      (function() {
        const KEY = 'readArticles';
        
        function getRead() {
          try {
            const d = localStorage.getItem(KEY);
            return d ? JSON.parse(d) : [];
          } catch (e) {
            return [];
          }
        }
        
        function markRead(url) {
          try {
            const read = getRead();
            if (!read.includes(url)) {
              read.push(url);
              localStorage.setItem(KEY, JSON.stringify(read));
            }
          } catch (e) {}
        }
        
        function updateCards() {
          const read = new Set(getRead());
          const cards = document.querySelectorAll('.post-card[data-article-url]');
          cards.forEach(function(card) {
            const url = card.getAttribute('data-article-url');
            if (!url) return;
            const isRead = read.has(url);
            card.classList.toggle('read', isRead);
            card.classList.toggle('unread', !isRead);
          });
        }
        
        function markCurrent() {
          if (document.querySelector('.post-body')) {
            markRead(window.location.pathname);
          }
        }
        
        function init() {
          updateCards();
          markCurrent();
        }
        
        function clearRead(url) {
          try {
            const read = new Set(getRead());
            if (read.has(url)) {
              read.delete(url);
              localStorage.setItem(KEY, JSON.stringify(Array.from(read)));
              updateCards();
            }
          } catch (e) {}
        }
        
        window.clearReadArticle = clearRead;
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('pageshow', function(e) {
          if (e.persisted) init();
        });
      })();
    </script> <!-- Clear read button handler --> <script>
      (function() {
        document.addEventListener('click', function(e) {
          var tgt = e.target, btn = null;
          while (tgt && tgt !== document) {
            if (tgt.classList && tgt.classList.contains('clear-read-btn')) {
              btn = tgt;
              break;
            }
            tgt = tgt.parentNode;
          }
          if (!btn) return;
          e.preventDefault();
          e.stopPropagation();
          var url = btn.getAttribute('data-article-url');
          if (url && window.clearReadArticle) window.clearReadArticle(url);
        });
      })();
    </script> <!-- External links open in new tab --> <script>
      (function() {
        function makeExternal() {
          const domain = window.location.hostname;
          const links = document.querySelectorAll('a[href]');
          links.forEach(function(link) {
            const href = link.getAttribute('href');
            if (!href || link.hasAttribute('target')) return;
            const isExt = (href.startsWith('http://') || href.startsWith('https://')) && !href.includes(domain);
            if (isExt) {
              link.setAttribute('target', '_blank');
              link.setAttribute('rel', 'noopener noreferrer');
            }
          });
        }
        document.addEventListener('DOMContentLoaded', makeExternal);
        if (window.MutationObserver) {
          const obs = new MutationObserver(function(muts) {
            muts.forEach(function(mut) {
              if (mut.addedNodes.length) makeExternal();
            });
          });
          obs.observe(document.body, { childList: true, subtree: true });
        }
      })();
    </script> <!-- Code copy buttons --> <script>
      (function() {
        function createBtn() {
          const btn = document.createElement('button');
          btn.className = 'copy-code-button';
          btn.setAttribute('aria-label', 'Copy code to clipboard');
          btn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            <span>Copy</span>
          `;
          return btn;
        }
        
        function checkIcon() {
          return `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Copied!</span>
          `;
        }
        
        async function copyText(txt) {
          try {
            await navigator.clipboard.writeText(txt);
            return true;
          } catch (err) {
            const ta = document.createElement('textarea');
            ta.value = txt;
            ta.style.position = 'fixed';
            ta.style.left = '-999999px';
            document.body.appendChild(ta);
            ta.select();
            try {
              document.execCommand('copy');
              document.body.removeChild(ta);
              return true;
            } catch (e) {
              document.body.removeChild(ta);
              return false;
            }
          }
        }
        
        async function handleCopy(btn, code) {
          const txt = code.textContent || '';
          const ok = await copyText(txt);
          if (ok) {
            const orig = btn.innerHTML;
            btn.classList.add('copied');
            btn.innerHTML = checkIcon();
            setTimeout(function() {
              btn.classList.remove('copied');
              btn.innerHTML = orig;
            }, 2000);
          }
        }
        
        function addBtns() {
          const blocks = document.querySelectorAll('.post-body pre');
          blocks.forEach(function(pre) {
            if (pre.querySelector('.copy-code-button')) return;
            const btn = createBtn();
            const code = pre.querySelector('code');
            if (code) {
              btn.addEventListener('click', function() {
                handleCopy(btn, code);
              });
              pre.appendChild(btn);
            }
          });
        }
        
        document.addEventListener('DOMContentLoaded', addBtns);
      })();
    </script> <!-- Newsletter Subscription Popup --> <div id="subscription-popup" class="subscription-popup" data-state="hidden" data-auto-trigger="true" data-astro-cid-we5gmdnp> <div class="popup-overlay" id="popup-overlay" data-astro-cid-we5gmdnp></div> <div class="popup-container" data-astro-cid-we5gmdnp> <div class="popup-content" data-astro-cid-we5gmdnp> <div class="popup-icon" data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-we5gmdnp> <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-astro-cid-we5gmdnp></path> <polyline points="22,6 12,13 2,6" data-astro-cid-we5gmdnp></polyline> </svg> </div> <h2 class="popup-title" data-astro-cid-we5gmdnp>Stay Updated with Dev|Journal</h2> <p class="popup-description" id="popup-description" data-astro-cid-we5gmdnp>
Join our community of developers and engineers. Get insights on:
</p> <ul class="popup-features" data-astro-cid-we5gmdnp> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
Software Architecture & Design Patterns
</li> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
Backend Development Best Practices
</li> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
AI & Tech Industry Analysis
</li> </ul> <form id="subscription-form" class="popup-form" data-astro-cid-we5gmdnp> <div class="form-group" data-astro-cid-we5gmdnp> <input type="text" id="subscriber-name" name="name" placeholder="Your name" required autocomplete="name" data-astro-cid-we5gmdnp> </div> <div class="form-group" data-astro-cid-we5gmdnp> <input type="email" id="subscriber-email" name="email" placeholder="your.email@example.com" required autocomplete="email" data-astro-cid-we5gmdnp> </div> <div id="form-message" class="form-message" data-astro-cid-we5gmdnp></div> <div class="popup-actions" data-astro-cid-we5gmdnp> <button type="submit" class="btn btn-primary" id="subscribe-btn" data-astro-cid-we5gmdnp> <span class="btn-text" data-astro-cid-we5gmdnp>Subscribe</span> <span class="btn-loader" data-astro-cid-we5gmdnp> <svg class="spinner" viewBox="0 0 24 24" data-astro-cid-we5gmdnp> <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" data-astro-cid-we5gmdnp></circle> </svg> </span> </button> <button type="button" class="btn btn-secondary" id="not-now-btn" data-astro-cid-we5gmdnp>Not Now</button> <button type="button" class="btn btn-text" id="cancel-btn" data-astro-cid-we5gmdnp>Don't Show Again</button> </div> </form> </div> </div> </div>  <script>
  // Configuration
  const CONFIG = {
    graceDelay: 5000, // 5 seconds delay before showing popup
    notNowDelay: 24 * 60 * 60 * 1000, // 1 day in milliseconds
    apiUrl: 'https://api.earezki.com/blog/api',
  };

  const STORAGE_KEYS = {
    subscribed: 'newsletter_subscribed',
    cancelled: 'newsletter_cancelled',
    notNowUntil: 'newsletter_not_now_until',
  };

  // State management
  let popupTimeout = null;

  function showPopup() {
    const popup = document.getElementById('subscription-popup');
    if (popup) {
      popup.setAttribute('data-state', 'visible');
      document.body.style.overflow = 'hidden';
    }
  }

  function hidePopup() {
    const popup = document.getElementById('subscription-popup');
    if (popup) {
      popup.setAttribute('data-state', 'hidden');
      document.body.style.overflow = '';
    }
  }

  function shouldShowPopup() {
    // Check if user has already subscribed
    if (localStorage.getItem(STORAGE_KEYS.subscribed) === 'true') {
      return false;
    }

    // Check if user clicked "Don't show again"
    if (localStorage.getItem(STORAGE_KEYS.cancelled) === 'true') {
      return false;
    }

    // Check if user clicked "Not now" and delay hasn't passed
    const notNowUntil = localStorage.getItem(STORAGE_KEYS.notNowUntil);
    if (notNowUntil) {
      const notNowTime = parseInt(notNowUntil, 10);
      if (Date.now() < notNowTime) {
        return false;
      }
    }

    return true;
  }

  async function getSubscriberStats() {
    try {
      const response = await fetch(`${CONFIG.apiUrl}/subscribers/stats`, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
        },
      });
      
      if (!response.ok) {
        return null;
      }
      
      const data = await response.json();
      return data.subscriber_count || null;
    } catch (error) {
      console.error('Failed to fetch subscriber stats:', error);
      return null;
    }
  }

  async function schedulePopup() {
    if (!shouldShowPopup()) {
      return;
    }

    // Fetch subscriber stats before scheduling popup
    const subscriberCount = await getSubscriberStats();
    if (subscriberCount === null) {
      console.log('Failed to fetch subscriber stats, not showing subscription popup');
      return;
    }

    // Update popup with subscriber count
    updatePopupWithStats(subscriberCount);

    // Show popup after grace period
    popupTimeout = window.setTimeout(() => {
      showPopup();
    }, CONFIG.graceDelay);
  }

  function updatePopupWithStats(count) {
    const descriptionEl = document.querySelector('.popup-description');
    if (descriptionEl) {
      const formattedCount = new Intl.NumberFormat('en-US').format(count);
      descriptionEl.innerHTML = `Join a community of <strong>${formattedCount}+</strong> developers and engineers who are growing together. Get insights on:`;
    }
  }

  async function handleSubscribe(event) {
    event.preventDefault();
    
    const form = event.target;
    const nameInput = form.querySelector('#subscriber-name');
    const emailInput = form.querySelector('#subscriber-email');
    const submitBtn = form.querySelector('#subscribe-btn');
    const messageEl = document.getElementById('form-message');

    const name = nameInput.value.trim();
    const email = emailInput.value.trim();

    if (!name || !email) {
      if (messageEl) {
        messageEl.textContent = 'Please fill in all fields.';
        messageEl.className = 'form-message error';
      }
      return;
    }

    // Show loading state
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    if (messageEl) {
      messageEl.textContent = '';
      messageEl.className = 'form-message';
    }

    try {
      const response = await fetch(`${CONFIG.apiUrl}/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ name, email }),
      });

      const data = await response.json();

      if (data.success) {
        localStorage.setItem(STORAGE_KEYS.subscribed, 'true');
        
        if (messageEl) {
          messageEl.textContent = 'üéâ Successfully subscribed! Thank you for joining us.';
          messageEl.className = 'form-message success';
        }

        // Hide popup after 2 seconds
        setTimeout(() => {
          hidePopup();
        }, 2000);
      } else {
        if (messageEl) {
          messageEl.textContent = data.error || 'Subscription failed. Please try again.';
          messageEl.className = 'form-message error';
        }
      }
    } catch (error) {
      console.error('Subscription error:', error);
      if (messageEl) {
        messageEl.textContent = 'Network error. Please check your connection and try again.';
        messageEl.className = 'form-message error';
      }
    } finally {
      submitBtn.classList.remove('loading');
      submitBtn.disabled = false;
    }
  }

  function handleNotNow() {
    const notNowUntil = Date.now() + CONFIG.notNowDelay;
    localStorage.setItem(STORAGE_KEYS.notNowUntil, notNowUntil.toString());
    hidePopup();
  }

  function handleCancel() {
    localStorage.setItem(STORAGE_KEYS.cancelled, 'true');
    hidePopup();
  }

  // Initialize popup
  document.addEventListener('DOMContentLoaded', () => {
    const popup = document.getElementById('subscription-popup');
    const autoTrigger = popup?.getAttribute('data-auto-trigger') === 'true';
    
    // Schedule popup to show after grace period only if autoTrigger is enabled
    if (autoTrigger) {
      schedulePopup();
    }

    // Event listeners
    const form = document.getElementById('subscription-form');
    const overlay = document.getElementById('popup-overlay');
    const notNowBtn = document.getElementById('not-now-btn');
    const cancelBtn = document.getElementById('cancel-btn');

    if (form) {
      form.addEventListener('submit', handleSubscribe);
    }

    if (overlay) {
      overlay.addEventListener('click', handleNotNow);
    }

    if (notNowBtn) {
      notNowBtn.addEventListener('click', handleNotNow);
    }

    if (cancelBtn) {
      cancelBtn.addEventListener('click', handleCancel);
    }

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      if (popupTimeout) {
        clearTimeout(popupTimeout);
      }
    });
  });
</script> </body></html> 