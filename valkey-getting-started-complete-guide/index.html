<!DOCTYPE html><html lang="en" data-theme="dark"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Valkey Complete Getting Started Guide: Production-Ready in 30 Minutes • Dev|Journal</title><meta name="description" content="TL;DR Valkey is the open-source fork of Redis that's actually faster and uses less memory. This guide takes you from zero to production, Docker and native…"><meta name="keywords" content="Infrastructure, Databases, DevOps, Tutorial, Python"><meta name="author" content="El Mehdi Arezki"><meta property="og:type" content="website"><meta property="og:url" content="https://earezki.com/valkey-getting-started-complete-guide/"><meta property="og:title" content="Valkey Complete Getting Started Guide: Production-Ready in 30 Minutes • Dev|Journal"><meta property="og:site_name" content="Dev|Journal"><meta property="og:description" content="TL;DR Valkey is the open-source fork of Redis that's actually faster and uses less memory. This guide takes you from zero to production, Docker and native…"><meta property="og:image" content="https://earezki.com/assets/og-image-default.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://earezki.com/valkey-getting-started-complete-guide/"><meta name="twitter:title" content="Valkey Complete Getting Started Guide: Production-Ready in 30 Minutes • Dev|Journal"><meta name="twitter:description" content="TL;DR Valkey is the open-source fork of Redis that's actually faster and uses less memory. This guide takes you from zero to production, Docker and native…"><meta name="twitter:image" content="https://earezki.com/assets/og-image-default.jpg"><meta name="twitter:creator" content="@earezki"><link rel="canonical" href="https://earezki.com/valkey-getting-started-complete-guide/"><link rel="icon" type="image/png" href="/assets/favicon_48_d.webp"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="dns-prefetch" href="https://cloud.umami.is"><script defer src="https://cloud.umami.is/script.js" data-website-id="4a26531d-1053-4f79-97a6-06a1366aff91"></script><script>
      (function() {
        const theme = localStorage.getItem('theme');
        if (theme) document.documentElement.setAttribute('data-theme', theme);
      })();
    </script><script>
!function(){const o=window.location.pathname;if("/"===o)return;if(/\.\w+$/.test(o))return;const n=o.toLowerCase(),i=n!==o,t=!o.endsWith("/");if(i||t){const o=n+(t?"/":""),i=window.location.origin+o+window.location.search+window.location.hash;window.location.replace(i)}}();
</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Valkey Complete Getting Started Guide: Production-Ready in 30 Minutes","description":"TL;DR Valkey is the open-source fork of Redis that's actually faster and uses less memory. This guide takes you from zero to production, Docker and native…","image":"https://earezki.com/assets/og-image-default.jpg","datePublished":"2025-11-24T00:00:00.000Z","dateModified":"2025-11-24T00:00:00.000Z","author":{"@type":"Person","name":"El Mehdi Arezki","url":"https://earezki.com/about","jobTitle":"Lead Software Engineer","sameAs":["https://github.com/earezki","https://www.linkedin.com/in/mehdi-arezki"]},"publisher":{"@type":"Organization","name":"Dev|Journal","url":"https://earezki.com","logo":{"@type":"ImageObject","url":"https://earezki.com/assets/logo.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://earezki.com/valkey-getting-started-complete-guide/"}}</script><link rel="stylesheet" href="/_astro/_slug_.B_eXuGWa.css">
<link rel="stylesheet" href="/_astro/_slug_.CFj9bTVJ.css">
<link rel="stylesheet" href="/_astro/_slug_.BuIxISHP.css"></head> <body> <div id="readingProgress" role="progressbar" aria-label="Reading progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="position:fixed;left:0;top:0;height:3px;background:linear-gradient(90deg,#2563eb,#9333ea);width:0;z-index:999;transition:width .15s ease;"></div> <script type="module">function c(){const t=document.getElementById("readingProgress");if(!t)return;const o=()=>{const e=document.documentElement,r=e.scrollTop||document.body.scrollTop,s=e.scrollHeight-e.clientHeight,n=s>0?r/s*100:0;t.style.width=`${n}%`,t.setAttribute("aria-valuenow",n.toFixed(0))};document.addEventListener("scroll",o,{passive:!0}),o()}c();</script> <header class="site-header container"> <div class="logo-wrap"> <a class="logo" href="/" aria-label="Dev|Journal Home">
Dev|Journal
</a> </div> <!-- Search Box in Header --> <div class="header-search" data-search-api-url="https://api.earezki.com/blog/api/q" data-search-timeout="2000"> <div class="search-box" id="search-box"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon" aria-hidden="true"> <circle cx="11" cy="11" r="8"></circle> <path d="m21 21-4.35-4.35"></path> </svg> <input type="text" id="search-input" placeholder="Search ..." class="search-input" autocomplete="off" aria-label="Search articles" minlength="3"> <button id="clear-search" class="clear-button" style="display: none;" aria-label="Clear search"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg> </button> </div> <div id="search-results" class="search-results" role="status" aria-live="polite"></div> </div> <script type="module" src="/_astro/SearchBox.astro_astro_type_script_index_0_lang.BNnBPVSN.js"></script> <nav class="main-nav" aria-label="Main navigation"> <a href="/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path> <polyline points="9 22 9 12 15 12 15 22"></polyline> </svg>
Home
</a> <a href="/ai-news/" class="ai-news-link ai-gradient-nav"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h-9.5a.5.5 0 0 0-.5.5.5.5 0 0 1-1 0 .5.5 0 0 0-.5-.5H1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path> <path d="M7 15v4a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-4"></path> </svg>
AI News
</a> <a href="/ai-financial-news/" class="ai-financial-link ai-gradient-nav"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <line x1="12" y1="1" x2="12" y2="23"></line> <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path> </svg>
AI Financial
</a> <a href="/about/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <circle cx="12" cy="12" r="10"></circle> <path d="M12 16v-4"></path> <path d="M12 8h.01"></path> </svg>
About
</a> <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode"> <span class="theme-icon" aria-hidden="true">☾</span> </button> </nav> </header> <!-- Main Content --> <main class="container content-area">  <nav class="breadcrumbs" aria-label="Breadcrumb" data-astro-cid-ilhxcym7> <ol data-astro-cid-ilhxcym7> <li data-astro-cid-ilhxcym7>  <a href="/" data-astro-cid-ilhxcym7>Home</a> <span class="separator" aria-hidden="true" data-astro-cid-ilhxcym7>/</span>  </li><li data-astro-cid-ilhxcym7> <span class="current" aria-current="page" data-astro-cid-ilhxcym7>Valkey Complete Getting Started Guide: Production-Ready in 30 Minutes</span> </li>  </ol> </nav>  <div class="post-layout" data-astro-cid-yvbahnfj> <aside class="sidebar-left" data-astro-cid-yvbahnfj> <nav class="toc" aria-label="Table of Contents" data-astro-cid-xvrfupwn> <div class="toc-title" data-astro-cid-xvrfupwn>On this page</div> <ul data-astro-cid-xvrfupwn> <li class="d-2" data-astro-cid-xvrfupwn> <a href="#tldr" data-astro-cid-xvrfupwn> TL;DR </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#before-you-start-why-valkey" data-astro-cid-xvrfupwn> Before You Start: Why Valkey? </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#installation-pick-your-poison" data-astro-cid-xvrfupwn> Installation: Pick Your Poison </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#docker-the-fast-path" data-astro-cid-xvrfupwn> Docker: The Fast Path </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#cloud-managed-services-the-easy-button" data-astro-cid-xvrfupwn> Cloud Managed Services: The Easy Button </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#python-client-setup-the-right-way" data-astro-cid-xvrfupwn> Python Client Setup: The Right Way </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#installation" data-astro-cid-xvrfupwn> Installation </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#basic-connection" data-astro-cid-xvrfupwn> Basic Connection </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#production-connection-pool" data-astro-cid-xvrfupwn> Production Connection Pool </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#authentication-and-security" data-astro-cid-xvrfupwn> Authentication and Security </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#core-operations-the-five-data-structures-you-actually-use" data-astro-cid-xvrfupwn> Core Operations: The Five Data Structures You Actually Use </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#1-strings-key-value" data-astro-cid-xvrfupwn> 1. Strings (Key-Value) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#2-hashes-objects" data-astro-cid-xvrfupwn> 2. Hashes (Objects) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#3-lists-queues-stacks" data-astro-cid-xvrfupwn> 3. Lists (Queues, Stacks) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#4-sets-unique-collections" data-astro-cid-xvrfupwn> 4. Sets (Unique Collections) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#5-sorted-sets-leaderboards-rankings" data-astro-cid-xvrfupwn> 5. Sorted Sets (Leaderboards, Rankings) </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#advanced-patterns" data-astro-cid-xvrfupwn> Advanced Patterns </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#rate-limiting-sliding-window" data-astro-cid-xvrfupwn> Rate Limiting (Sliding Window) </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#distributed-locks" data-astro-cid-xvrfupwn> Distributed Locks </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#pipelining-batching-commands" data-astro-cid-xvrfupwn> Pipelining (Batching Commands) </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#monitoring-know-before-youre-paged" data-astro-cid-xvrfupwn> Monitoring: Know Before You&#39;re Paged </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#key-metrics-to-watch" data-astro-cid-xvrfupwn> Key Metrics to Watch </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#alerts-to-set-up" data-astro-cid-xvrfupwn> Alerts to Set Up </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#common-mistakes-that-will-ruin-your-day" data-astro-cid-xvrfupwn> Common Mistakes That Will Ruin Your Day </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#1-not-setting-maxmemory" data-astro-cid-xvrfupwn> 1. Not Setting maxmemory </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#2-using-valkey-as-a-primary-database" data-astro-cid-xvrfupwn> 2. Using Valkey as a Primary Database </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#3-storing-large-objects" data-astro-cid-xvrfupwn> 3. Storing Large Objects </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#4-not-using-connection-pooling" data-astro-cid-xvrfupwn> 4. Not Using Connection Pooling </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#5-ignoring-persistence-trade-offs" data-astro-cid-xvrfupwn> 5. Ignoring Persistence Trade-offs </a> </li><li class="d-2" data-astro-cid-xvrfupwn> <a href="#final-thoughts" data-astro-cid-xvrfupwn> Final Thoughts </a> </li> </ul> </nav>  </aside> <article class="post" data-astro-cid-yvbahnfj> <header class="post-header" data-astro-cid-yvbahnfj> <h1 data-astro-cid-yvbahnfj>Valkey Complete Getting Started Guide: Production-Ready in 30 Minutes</h1> <div class="meta" data-astro-cid-yvbahnfj> <time datetime="2025-11-24T00:00:00.000Z" data-astro-cid-yvbahnfj>Mon Nov 24 2025</time> <span data-astro-cid-yvbahnfj>• 10 min read</span> </div> <div class="tag-row" data-astro-cid-yvbahnfj><a class="post-tag  " href="/tags/infrastructure/" data-astro-cid-yvbahnfj>Infrastructure</a><a class="post-tag  " href="/tags/databases/" data-astro-cid-yvbahnfj>Databases</a><a class="post-tag  " href="/tags/devops/" data-astro-cid-yvbahnfj>DevOps</a><a class="post-tag  " href="/tags/tutorial/" data-astro-cid-yvbahnfj>Tutorial</a><a class="post-tag  " href="/tags/python/" data-astro-cid-yvbahnfj>Python</a></div> </header>     <div class="post-body prose" data-astro-cid-yvbahnfj> <h2 id="tldr">TL;DR</h2>
<p>Valkey is the open-source fork of Redis that’s actually faster and uses less memory. This guide takes you from zero to production, Docker and native installation, Python client setup with real code examples, clustering for high availability, persistence configuration, monitoring dashboards, and the operational mistakes that will ruin your weekend. If you’ve read our <a href="/from-redis-to-valkey/">Redis to Valkey migration analysis</a>, you know why Valkey exists. This guide shows you how to use it.</p>
<h2 id="before-you-start-why-valkey">Before You Start: Why Valkey?</h2>
<p>I’ll keep this short because we covered the politics in the <a href="/from-redis-to-valkey/">migration article</a>. The facts that matter for this tutorial:</p>
<ul>
<li><strong>License:</strong> BSD 3-Clause, actually open source, no vendor lock-in</li>
<li><strong>Performance:</strong> 2-3x throughput vs Redis 7.2 thanks to multi-threaded I/O</li>
<li><strong>Memory:</strong> 20-30% less RAM usage from embedded key optimization</li>
<li><strong>Compatibility:</strong> 100% Redis protocol compatible, existing apps work</li>
<li><strong>Stability:</strong> Atomic cluster migrations, no more broken resharding</li>
</ul>
<p>If you’re starting fresh, use Valkey. If you’re migrating from Redis, <a href="/from-redis-to-valkey/#how-to-migrate-without-downtime">read this first</a>.</p>
<h2 id="installation-pick-your-poison">Installation: Pick Your Poison</h2>
<h3 id="docker-the-fast-path">Docker: The Fast Path</h3>
<p>Docker Compose is the cleanest way to run Valkey with persistence. Create a <code>docker-compose.yml</code>:</p>
<pre class="language-yaml" data-language="yaml"><code is:raw="" class="language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.8'</span>

<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">valkey</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> valkey/valkey<span class="token punctuation">:</span><span class="token number">9.0</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> valkey
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> unless<span class="token punctuation">-</span>stopped
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"6379:6379"</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> valkey<span class="token punctuation">-</span>data<span class="token punctuation">:</span>/data
      <span class="token punctuation">-</span> ./valkey.conf<span class="token punctuation">:</span>/etc/valkey/valkey.conf
    <span class="token key atrule">command</span><span class="token punctuation">:</span> valkey<span class="token punctuation">-</span>server /etc/valkey/valkey.conf
    <span class="token key atrule">mem_limit</span><span class="token punctuation">:</span> 2.5g
    <span class="token key atrule">healthcheck</span><span class="token punctuation">:</span>
      <span class="token key atrule">test</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"CMD"</span><span class="token punctuation">,</span> <span class="token string">"valkey-cli"</span><span class="token punctuation">,</span> <span class="token string">"ping"</span><span class="token punctuation">]</span>
      <span class="token key atrule">interval</span><span class="token punctuation">:</span> 10s
      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> 3s
      <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span>

<span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token key atrule">valkey-data</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> local
</code></pre>
<p>Create the config file <code>valkey.conf</code>:</p>
<pre class="language-text" data-language="text"><code is:raw="" class="language-text"># Network
bind 0.0.0.0
port 6379
tcp-backlog 511
timeout 0
tcp-keepalive 300

# Memory
maxmemory 2gb
maxmemory-policy allkeys-lru
maxmemory-samples 5

# Persistence
save 900 1
save 300 10
save 60 10000
appendonly yes
appendfsync everysec
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# Performance (Valkey 9.0 multi-threaded I/O)
io-threads 4
io-threads-do-reads yes

# Logging
loglevel notice
logfile ""

# Slow log
slowlog-log-slower-than 10000
slowlog-max-len 128
</code></pre>
<p>Start it:</p>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash"><span class="token comment"># Start in background</span>
<span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>

<span class="token comment"># Verify it's running</span>
<span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> valkey valkey-cli <span class="token function">ping</span>
<span class="token comment"># Should return: PONG</span>

<span class="token comment"># View logs</span>
<span class="token function">docker-compose</span> logs <span class="token parameter variable">-f</span> valkey

<span class="token comment"># Stop</span>
<span class="token function">docker-compose</span> down
</code></pre>
<p><strong>Key config choices explained:</strong></p>
<ul>
<li><code>io-threads 4</code>: Enables multi-threaded I/O, the killer feature in Valkey 9.0. Set this to the number of CPU cores you want to dedicate (typically 2-4).</li>
<li><code>maxmemory 2gb</code>: Hard limit. Valkey will evict keys or reject writes when this is hit. Always set this.</li>
<li><code>maxmemory-policy allkeys-lru</code>: When memory is full, evict the least recently used keys. Use <code>volatile-lru</code> if you only want to evict keys with TTL, or <code>noeviction</code> if you want writes to fail instead.</li>
<li><code>appendfsync everysec</code>: Write to disk every second. Balances durability and performance. Use <code>always</code> for maximum safety (slow) or <code>no</code> for maximum speed (data loss risk).</li>
<li>Named volume <code>valkey-data</code>: Your data survives container restarts and rebuilds</li>
</ul>
<h3 id="cloud-managed-services-the-easy-button">Cloud Managed Services: The Easy Button</h3>
<p>If you’re on AWS or Google Cloud, let them handle the operational toil.</p>
<p><strong>AWS ElastiCache for Valkey:</strong></p>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash"><span class="token comment"># Create a Valkey cluster (replace subnet group with yours)</span>
aws elasticache create-cache-cluster <span class="token punctuation">\</span>
  --cache-cluster-id valkey-prod <span class="token punctuation">\</span>
  <span class="token parameter variable">--engine</span> valkey <span class="token punctuation">\</span>
  --engine-version <span class="token number">8.0</span> <span class="token punctuation">\</span>
  --cache-node-type cache.r7g.large <span class="token punctuation">\</span>
  --num-cache-nodes <span class="token number">1</span> <span class="token punctuation">\</span>
  --cache-subnet-group-name your-subnet-group <span class="token punctuation">\</span>
  --preferred-availability-zone us-east-1a

<span class="token comment"># For production with Multi-AZ replication</span>
aws elasticache create-replication-group <span class="token punctuation">\</span>
  --replication-group-id valkey-prod-cluster <span class="token punctuation">\</span>
  --replication-group-description <span class="token string">"Production Valkey cluster"</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--engine</span> valkey <span class="token punctuation">\</span>
  --cache-node-type cache.r7g.large <span class="token punctuation">\</span>
  --num-cache-clusters <span class="token number">2</span> <span class="token punctuation">\</span>
  --automatic-failover-enabled <span class="token punctuation">\</span>
  --multi-az-enabled <span class="token punctuation">\</span>
  --cache-subnet-group-name your-subnet-group

<span class="token comment"># Get connection endpoint</span>
aws elasticache describe-cache-clusters <span class="token punctuation">\</span>
  --cache-cluster-id valkey-prod <span class="token punctuation">\</span>
  --show-cache-node-info
</code></pre>
<p>You get automatic failover, patching, monitoring, and it’s 20% cheaper than Redis OSS tier.</p>
<p><strong>Google Cloud Memorystore for Valkey:</strong></p>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash">gcloud redis instances create valkey-prod <span class="token punctuation">\</span>
  <span class="token parameter variable">--size</span><span class="token operator">=</span><span class="token number">5</span> <span class="token punctuation">\</span>
  <span class="token parameter variable">--region</span><span class="token operator">=</span>us-central1 <span class="token punctuation">\</span>
  --redis-version<span class="token operator">=</span>valkey_9_0 <span class="token punctuation">\</span>
  <span class="token parameter variable">--tier</span><span class="token operator">=</span>standard_ha

<span class="token comment"># Get connection info</span>
gcloud redis instances describe valkey-prod <span class="token punctuation">\</span>
  <span class="token parameter variable">--region</span><span class="token operator">=</span>us-central1
</code></pre>
<p>Both services give you a connection string. Point your app at it and you’re done.</p>
<h2 id="python-client-setup-the-right-way">Python Client Setup: The Right Way</h2>
<p>The official Python client is <code>valkey-py</code>. Do <strong>not</strong> use <code>redis-py</code> for new projects (it’s controlled by Redis Ltd. and will nag you with warnings).</p>
<h3 id="installation">Installation</h3>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash">pip <span class="token function">install</span> valkey
</code></pre>
<p>For async support (if you’re using FastAPI, aiohttp, etc.):</p>
<pre class="language-bash" data-language="bash"><code is:raw="" class="language-bash">pip <span class="token function">install</span> <span class="token string">'valkey[async]'</span>
</code></pre>
<h3 id="basic-connection">Basic Connection</h3>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">from</span> valkey <span class="token keyword">import</span> Valkey

<span class="token comment"># Simple connection</span>
client <span class="token operator">=</span> Valkey<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
    port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span>
    decode_responses<span class="token operator">=</span><span class="token boolean">True</span>  <span class="token comment"># Return strings instead of bytes</span>
<span class="token punctuation">)</span>

<span class="token comment"># Test it</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># "world"</span>
</code></pre>
<h3 id="production-connection-pool">Production Connection Pool</h3>
<p>Never create a new connection per request. Use connection pooling:</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">from</span> valkey <span class="token keyword">import</span> ConnectionPool<span class="token punctuation">,</span> Valkey

<span class="token comment"># Create pool once at app startup</span>
pool <span class="token operator">=</span> ConnectionPool<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
    port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span>
    max_connections<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span>  <span class="token comment"># Tune based on your concurrency</span>
    socket_keepalive<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    socket_connect_timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    socket_timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>
    retry_on_timeout<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    health_check_interval<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
    decode_responses<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>

<span class="token comment"># Reuse the pool</span>
client <span class="token operator">=</span> Valkey<span class="token punctuation">(</span>connection_pool<span class="token operator">=</span>pool<span class="token punctuation">)</span>
</code></pre>
<p><strong>Why pooling matters:</strong> Establishing a TCP connection is expensive (DNS lookup, TCP handshake, TLS negotiation if enabled). A pool reuses connections, reducing latency from ~10ms to ~0.1ms.</p>
<h3 id="authentication-and-security">Authentication and Security</h3>
<p>If you set <code>requirepass</code> in <code>valkey.conf</code>:</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python">client <span class="token operator">=</span> Valkey<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
    port<span class="token operator">=</span><span class="token number">6379</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">'YourSecretPassword'</span><span class="token punctuation">,</span>
    decode_responses<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>
</code></pre>
<p>For TLS (production over the internet):</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python">client <span class="token operator">=</span> Valkey<span class="token punctuation">(</span>
    host<span class="token operator">=</span><span class="token string">'valkey.example.com'</span><span class="token punctuation">,</span>
    port<span class="token operator">=</span><span class="token number">6380</span><span class="token punctuation">,</span>
    password<span class="token operator">=</span><span class="token string">'YourSecretPassword'</span><span class="token punctuation">,</span>
    ssl<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
    ssl_cert_reqs<span class="token operator">=</span><span class="token string">'required'</span><span class="token punctuation">,</span>
    ssl_ca_certs<span class="token operator">=</span><span class="token string">'/path/to/ca.crt'</span><span class="token punctuation">,</span>
    decode_responses<span class="token operator">=</span><span class="token boolean">True</span>
<span class="token punctuation">)</span>
</code></pre>
<h2 id="core-operations-the-five-data-structures-you-actually-use">Core Operations: The Five Data Structures You Actually Use</h2>
<p>Valkey supports five core data types. Here’s how to use them in Python.</p>
<h3 id="1-strings-key-value">1. Strings (Key-Value)</h3>
<p>Simplest data type. Good for caching, feature flags, counters.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Set a value</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'user:1000:name'</span><span class="token punctuation">,</span> <span class="token string">'Alice'</span><span class="token punctuation">)</span>

<span class="token comment"># Get a value</span>
name <span class="token operator">=</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'user:1000:name'</span><span class="token punctuation">)</span>  <span class="token comment"># "Alice"</span>

<span class="token comment"># Set with expiration (TTL in seconds)</span>
client<span class="token punctuation">.</span>setex<span class="token punctuation">(</span><span class="token string">'session:abc123'</span><span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> <span class="token string">'user_data_here'</span><span class="token punctuation">)</span>

<span class="token comment"># Atomic increment (counters, rate limiting)</span>
page_views <span class="token operator">=</span> client<span class="token punctuation">.</span>incr<span class="token punctuation">(</span><span class="token string">'page:home:views'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Page views: </span><span class="token interpolation"><span class="token punctuation">{</span>page_views<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment"># Increment by amount</span>
client<span class="token punctuation">.</span>incrby<span class="token punctuation">(</span><span class="token string">'downloads:total'</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment"># Check if key exists</span>
<span class="token keyword">if</span> client<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'config:maintenance_mode'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Site is in maintenance mode"</span><span class="token punctuation">)</span>

<span class="token comment"># Delete a key</span>
client<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token string">'temp:processing:job123'</span><span class="token punctuation">)</span>

<span class="token comment"># Get multiple keys at once (batching)</span>
values <span class="token operator">=</span> client<span class="token punctuation">.</span>mget<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'user:1:name'</span><span class="token punctuation">,</span> <span class="token string">'user:2:name'</span><span class="token punctuation">,</span> <span class="token string">'user:3:name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Cache-aside pattern</strong></p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">import</span> json

<span class="token keyword">def</span> <span class="token function">get_user</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cache_key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'user:</span><span class="token interpolation"><span class="token punctuation">{</span>user_id<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    
    <span class="token comment"># Try cache first</span>
    cached <span class="token operator">=</span> client<span class="token punctuation">.</span>get<span class="token punctuation">(</span>cache_key<span class="token punctuation">)</span>
    <span class="token keyword">if</span> cached<span class="token punctuation">:</span>
        <span class="token keyword">return</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>cached<span class="token punctuation">)</span>
    
    <span class="token comment"># Cache miss, fetch from database</span>
    user <span class="token operator">=</span> database<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'SELECT * FROM users WHERE id = ?'</span><span class="token punctuation">,</span> user_id<span class="token punctuation">)</span>
    
    <span class="token comment"># Store in cache (1 hour TTL)</span>
    client<span class="token punctuation">.</span>setex<span class="token punctuation">(</span>cache_key<span class="token punctuation">,</span> <span class="token number">3600</span><span class="token punctuation">,</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> user
</code></pre>
<h3 id="2-hashes-objects">2. Hashes (Objects)</h3>
<p>Store objects with multiple fields. More memory-efficient than separate keys.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># INEFFICIENT: Separate keys (don't do this)</span>
<span class="token comment"># Each key has overhead: 8-byte pointer + malloc header (~16-32 bytes)</span>
<span class="token comment"># client.set('user:1000:name', 'Alice')        # ~50 bytes overhead</span>
<span class="token comment"># client.set('user:1000:email', 'alice@example.com')  # ~50 bytes overhead</span>
<span class="token comment"># client.set('user:1000:age', 30)              # ~50 bytes overhead</span>
<span class="token comment"># Total overhead: ~150 bytes just for metadata</span>

<span class="token comment"># EFFICIENT: Hash (do this instead)</span>
<span class="token comment"># Single hash with embedded fields saves ~40% memory</span>
<span class="token comment"># All fields stored together with minimal overhead</span>
client<span class="token punctuation">.</span>hset<span class="token punctuation">(</span><span class="token string">'user:1000'</span><span class="token punctuation">,</span> mapping<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'Alice'</span><span class="token punctuation">,</span>
    <span class="token string">'email'</span><span class="token punctuation">:</span> <span class="token string">'alice@example.com'</span><span class="token punctuation">,</span>
    <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    <span class="token string">'verified'</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># Get entire object</span>
user <span class="token operator">=</span> client<span class="token punctuation">.</span>hgetall<span class="token punctuation">(</span><span class="token string">'user:1000'</span><span class="token punctuation">)</span>
<span class="token comment"># {'name': 'Alice', 'email': 'alice@example.com', 'age': '30', 'verified': 'true'}</span>

<span class="token comment"># Get a single field</span>
email <span class="token operator">=</span> client<span class="token punctuation">.</span>hget<span class="token punctuation">(</span><span class="token string">'user:1000'</span><span class="token punctuation">,</span> <span class="token string">'email'</span><span class="token punctuation">)</span>

<span class="token comment"># Get multiple fields</span>
name<span class="token punctuation">,</span> age <span class="token operator">=</span> client<span class="token punctuation">.</span>hmget<span class="token punctuation">(</span><span class="token string">'user:1000'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Increment a numeric field</span>
client<span class="token punctuation">.</span>hincrby<span class="token punctuation">(</span><span class="token string">'user:1000'</span><span class="token punctuation">,</span> <span class="token string">'login_count'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># Check if field exists</span>
<span class="token keyword">if</span> client<span class="token punctuation">.</span>hexists<span class="token punctuation">(</span><span class="token string">'user:1000'</span><span class="token punctuation">,</span> <span class="token string">'premium'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"User is premium"</span><span class="token punctuation">)</span>

<span class="token comment"># Delete a field</span>
client<span class="token punctuation">.</span>hdel<span class="token punctuation">(</span><span class="token string">'user:1000'</span><span class="token punctuation">,</span> <span class="token string">'temp_token'</span><span class="token punctuation">)</span>
</code></pre>
<h3 id="3-lists-queues-stacks">3. Lists (Queues, Stacks)</h3>
<p>Ordered collections. Perfect for job queues, activity feeds, recent items.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Add to the right (tail)</span>
client<span class="token punctuation">.</span>rpush<span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">,</span> <span class="token string">'send_email'</span><span class="token punctuation">,</span> <span class="token string">'process_upload'</span><span class="token punctuation">,</span> <span class="token string">'resize_image'</span><span class="token punctuation">)</span>

<span class="token comment"># Add to the left (head)</span>
client<span class="token punctuation">.</span>lpush<span class="token punctuation">(</span><span class="token string">'notifications'</span><span class="token punctuation">,</span> <span class="token string">'new_message'</span><span class="token punctuation">)</span>

<span class="token comment"># Pop from the left (FIFO queue)</span>
task <span class="token operator">=</span> client<span class="token punctuation">.</span>lpop<span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span>  <span class="token comment"># "send_email"</span>

<span class="token comment"># Pop from the right (LIFO stack)</span>
task <span class="token operator">=</span> client<span class="token punctuation">.</span>rpop<span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span>  <span class="token comment"># "resize_image"</span>

<span class="token comment"># Blocking pop (wait for items, perfect for worker queues)</span>
task <span class="token operator">=</span> client<span class="token punctuation">.</span>blpop<span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># Blocks up to 5 seconds</span>
<span class="token keyword">if</span> task<span class="token punctuation">:</span>
    queue_name<span class="token punctuation">,</span> task_data <span class="token operator">=</span> task
    process_task<span class="token punctuation">(</span>task_data<span class="token punctuation">)</span>

<span class="token comment"># Get a range (pagination)</span>
recent_posts <span class="token operator">=</span> client<span class="token punctuation">.</span>lrange<span class="token punctuation">(</span><span class="token string">'user:1000:feed'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span>  <span class="token comment"># First 10 items</span>

<span class="token comment"># Get list length</span>
count <span class="token operator">=</span> client<span class="token punctuation">.</span>llen<span class="token punctuation">(</span><span class="token string">'tasks'</span><span class="token punctuation">)</span>

<span class="token comment"># Trim to keep only recent items (cap at 100)</span>
client<span class="token punctuation">.</span>ltrim<span class="token punctuation">(</span><span class="token string">'user:1000:activity'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Job queue</strong></p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Producer</span>
<span class="token keyword">def</span> <span class="token function">enqueue_job</span><span class="token punctuation">(</span>job_type<span class="token punctuation">,</span> job_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    job <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'type'</span><span class="token punctuation">:</span> job_type<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">:</span> job_data<span class="token punctuation">,</span> <span class="token string">'ts'</span><span class="token punctuation">:</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>rpush<span class="token punctuation">(</span><span class="token string">'jobs'</span><span class="token punctuation">,</span> job<span class="token punctuation">)</span>

<span class="token comment"># Consumer (worker process)</span>
<span class="token keyword">def</span> <span class="token function">process_jobs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        job <span class="token operator">=</span> client<span class="token punctuation">.</span>blpop<span class="token punctuation">(</span><span class="token string">'jobs'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> job<span class="token punctuation">:</span>
            _<span class="token punctuation">,</span> job_json <span class="token operator">=</span> job
            job_data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>job_json<span class="token punctuation">)</span>
            handle_job<span class="token punctuation">(</span>job_data<span class="token punctuation">)</span>
</code></pre>
<h3 id="4-sets-unique-collections">4. Sets (Unique Collections)</h3>
<p>Unordered collections of unique items. Good for tags, permissions, tracking unique visitors.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Add members</span>
client<span class="token punctuation">.</span>sadd<span class="token punctuation">(</span><span class="token string">'tags:post:42'</span><span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">,</span> <span class="token string">'databases'</span><span class="token punctuation">,</span> <span class="token string">'tutorial'</span><span class="token punctuation">)</span>

<span class="token comment"># Check membership</span>
<span class="token keyword">if</span> client<span class="token punctuation">.</span>sismember<span class="token punctuation">(</span><span class="token string">'tags:post:42'</span><span class="token punctuation">,</span> <span class="token string">'python'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Post is tagged with Python"</span><span class="token punctuation">)</span>

<span class="token comment"># Get all members</span>
tags <span class="token operator">=</span> client<span class="token punctuation">.</span>smembers<span class="token punctuation">(</span><span class="token string">'tags:post:42'</span><span class="token punctuation">)</span>
<span class="token comment"># {'python', 'databases', 'tutorial'}</span>

<span class="token comment"># Remove a member</span>
client<span class="token punctuation">.</span>srem<span class="token punctuation">(</span><span class="token string">'tags:post:42'</span><span class="token punctuation">,</span> <span class="token string">'tutorial'</span><span class="token punctuation">)</span>

<span class="token comment"># Count members</span>
count <span class="token operator">=</span> client<span class="token punctuation">.</span>scard<span class="token punctuation">(</span><span class="token string">'tags:post:42'</span><span class="token punctuation">)</span>

<span class="token comment"># Set operations</span>
client<span class="token punctuation">.</span>sadd<span class="token punctuation">(</span><span class="token string">'users:online:server1'</span><span class="token punctuation">,</span> <span class="token string">'user1'</span><span class="token punctuation">,</span> <span class="token string">'user2'</span><span class="token punctuation">,</span> <span class="token string">'user3'</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span>sadd<span class="token punctuation">(</span><span class="token string">'users:online:server2'</span><span class="token punctuation">,</span> <span class="token string">'user2'</span><span class="token punctuation">,</span> <span class="token string">'user3'</span><span class="token punctuation">,</span> <span class="token string">'user4'</span><span class="token punctuation">)</span>

<span class="token comment"># Union (all unique users)</span>
all_users <span class="token operator">=</span> client<span class="token punctuation">.</span>sunion<span class="token punctuation">(</span><span class="token string">'users:online:server1'</span><span class="token punctuation">,</span> <span class="token string">'users:online:server2'</span><span class="token punctuation">)</span>
<span class="token comment"># {'user1', 'user2', 'user3', 'user4'}</span>

<span class="token comment"># Intersection (users on both servers)</span>
both <span class="token operator">=</span> client<span class="token punctuation">.</span>sinter<span class="token punctuation">(</span><span class="token string">'users:online:server1'</span><span class="token punctuation">,</span> <span class="token string">'users:online:server2'</span><span class="token punctuation">)</span>
<span class="token comment"># {'user2', 'user3'}</span>

<span class="token comment"># Difference (only on server1)</span>
only_server1 <span class="token operator">=</span> client<span class="token punctuation">.</span>sdiff<span class="token punctuation">(</span><span class="token string">'users:online:server1'</span><span class="token punctuation">,</span> <span class="token string">'users:online:server2'</span><span class="token punctuation">)</span>
<span class="token comment"># {'user1'}</span>
</code></pre>
<p><strong>Unique visitor tracking</strong></p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Track daily unique visitors</span>
<span class="token keyword">def</span> <span class="token function">record_visitor</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">:</span>
    date_key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"visitors:</span><span class="token interpolation"><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
    client<span class="token punctuation">.</span>sadd<span class="token punctuation">(</span>date_key<span class="token punctuation">,</span> user_id<span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>expire<span class="token punctuation">(</span>date_key<span class="token punctuation">,</span> <span class="token number">86400</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span>  <span class="token comment"># Keep for 7 days</span>

<span class="token comment"># Get count</span>
<span class="token keyword">def</span> <span class="token function">get_daily_visitors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    date_key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"visitors:</span><span class="token interpolation"><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">'%Y-%m-%d'</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
    <span class="token keyword">return</span> client<span class="token punctuation">.</span>scard<span class="token punctuation">(</span>date_key<span class="token punctuation">)</span>
</code></pre>
<h3 id="5-sorted-sets-leaderboards-rankings">5. Sorted Sets (Leaderboards, Rankings)</h3>
<p>Sets where each member has a score. Members are sorted by score. Perfect for leaderboards, priority queues, time-series data.</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Add members with scores</span>
client<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token string">'player1'</span><span class="token punctuation">:</span> <span class="token number">1500</span><span class="token punctuation">,</span>
    <span class="token string">'player2'</span><span class="token punctuation">:</span> <span class="token number">2000</span><span class="token punctuation">,</span>
    <span class="token string">'player3'</span><span class="token punctuation">:</span> <span class="token number">1750</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># Get rank (0-based, ascending order)</span>
rank <span class="token operator">=</span> client<span class="token punctuation">.</span>zrank<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token string">'player2'</span><span class="token punctuation">)</span>  <span class="token comment"># 2 (highest)</span>

<span class="token comment"># Get reverse rank (descending)</span>
rank <span class="token operator">=</span> client<span class="token punctuation">.</span>zrevrank<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token string">'player2'</span><span class="token punctuation">)</span>  <span class="token comment"># 0 (1st place)</span>

<span class="token comment"># Get top 10 (with scores)</span>
top_players <span class="token operator">=</span> client<span class="token punctuation">.</span>zrevrange<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># [('player2', 2000.0), ('player3', 1750.0), ('player1', 1500.0)]</span>

<span class="token comment"># Increment score</span>
client<span class="token punctuation">.</span>zincrby<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token string">'player1'</span><span class="token punctuation">)</span>  <span class="token comment"># Add 50 points</span>

<span class="token comment"># Get score</span>
score <span class="token operator">=</span> client<span class="token punctuation">.</span>zscore<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token string">'player1'</span><span class="token punctuation">)</span>

<span class="token comment"># Get count</span>
total_players <span class="token operator">=</span> client<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">)</span>

<span class="token comment"># Get by score range</span>
mid_tier <span class="token operator">=</span> client<span class="token punctuation">.</span>zrangebyscore<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token number">1800</span><span class="token punctuation">,</span> withscores<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># Remove low scorers</span>
client<span class="token punctuation">.</span>zremrangebyscore<span class="token punctuation">(</span><span class="token string">'leaderboard'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre>
<p><strong>Time-series events</strong></p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Store events with timestamps as scores</span>
<span class="token keyword">def</span> <span class="token function">log_event</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> event_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
    key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'events:</span><span class="token interpolation"><span class="token punctuation">{</span>user_id<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    timestamp <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    event_data <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">'type'</span><span class="token punctuation">:</span> event_type<span class="token punctuation">,</span> <span class="token string">'ts'</span><span class="token punctuation">:</span> timestamp<span class="token punctuation">}</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">{</span>event_data<span class="token punctuation">:</span> timestamp<span class="token punctuation">}</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Keep only last 1000 events</span>
    client<span class="token punctuation">.</span>zremrangebyrank<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1001</span><span class="token punctuation">)</span>

<span class="token comment"># Get recent events</span>
<span class="token keyword">def</span> <span class="token function">get_recent_events</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> limit<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'events:</span><span class="token interpolation"><span class="token punctuation">{</span>user_id<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    events <span class="token operator">=</span> client<span class="token punctuation">.</span>zrevrange<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> limit <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token keyword">for</span> e <span class="token keyword">in</span> events<span class="token punctuation">]</span>
</code></pre>
<h2 id="advanced-patterns">Advanced Patterns</h2>
<h3 id="rate-limiting-sliding-window">Rate Limiting (Sliding Window)</h3>
<p>Better than the simple counter approach:</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">def</span> <span class="token function">is_rate_limited</span><span class="token punctuation">(</span>user_id<span class="token punctuation">,</span> max_requests<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> window_seconds<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'rate:</span><span class="token interpolation"><span class="token punctuation">{</span>user_id<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    now <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token comment"># Remove requests older than the window</span>
    client<span class="token punctuation">.</span>zremrangebyscore<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> now <span class="token operator">-</span> window_seconds<span class="token punctuation">)</span>
    
    <span class="token comment"># Count requests in current window</span>
    count <span class="token operator">=</span> client<span class="token punctuation">.</span>zcard<span class="token punctuation">(</span>key<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> count <span class="token operator">>=</span> max_requests<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token boolean">True</span>
    
    <span class="token comment"># Add current request</span>
    client<span class="token punctuation">.</span>zadd<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token builtin">str</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">:</span> now<span class="token punctuation">}</span><span class="token punctuation">)</span>
    client<span class="token punctuation">.</span>expire<span class="token punctuation">(</span>key<span class="token punctuation">,</span> window_seconds<span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token boolean">False</span>
</code></pre>
<h3 id="distributed-locks">Distributed Locks</h3>
<p>For coordinating work across multiple servers:</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">import</span> uuid

<span class="token keyword">def</span> <span class="token function">acquire_lock</span><span class="token punctuation">(</span>lock_name<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    identifier <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>uuid<span class="token punctuation">.</span>uuid4<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    lock_key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'lock:</span><span class="token interpolation"><span class="token punctuation">{</span>lock_name<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    
    <span class="token comment"># Try to set the lock with NX (only if not exists)</span>
    acquired <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>lock_key<span class="token punctuation">,</span> identifier<span class="token punctuation">,</span> nx<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> ex<span class="token operator">=</span>timeout<span class="token punctuation">)</span>
    
    <span class="token keyword">if</span> acquired<span class="token punctuation">:</span>
        <span class="token keyword">return</span> identifier
    <span class="token keyword">return</span> <span class="token boolean">None</span>

<span class="token keyword">def</span> <span class="token function">release_lock</span><span class="token punctuation">(</span>lock_name<span class="token punctuation">,</span> identifier<span class="token punctuation">)</span><span class="token punctuation">:</span>
    lock_key <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f'lock:</span><span class="token interpolation"><span class="token punctuation">{</span>lock_name<span class="token punctuation">}</span></span><span class="token string">'</span></span>
    
    <span class="token comment"># Only delete if we own the lock (prevent releasing someone else's lock)</span>
    pipe <span class="token operator">=</span> client<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            pipe<span class="token punctuation">.</span>watch<span class="token punctuation">(</span>lock_key<span class="token punctuation">)</span>
            <span class="token keyword">if</span> pipe<span class="token punctuation">.</span>get<span class="token punctuation">(</span>lock_key<span class="token punctuation">)</span> <span class="token operator">==</span> identifier<span class="token punctuation">:</span>
                pipe<span class="token punctuation">.</span>multi<span class="token punctuation">(</span><span class="token punctuation">)</span>
                pipe<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>lock_key<span class="token punctuation">)</span>
                pipe<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">True</span>
            pipe<span class="token punctuation">.</span>unwatch<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">except</span> Exception<span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
    <span class="token keyword">return</span> <span class="token boolean">False</span>

<span class="token comment"># Usage</span>
lock_id <span class="token operator">=</span> acquire_lock<span class="token punctuation">(</span><span class="token string">'process_payments'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> lock_id<span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        process_payments<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">finally</span><span class="token punctuation">:</span>
        release_lock<span class="token punctuation">(</span><span class="token string">'process_payments'</span><span class="token punctuation">,</span> lock_id<span class="token punctuation">)</span>
</code></pre>
<h3 id="pipelining-batching-commands">Pipelining (Batching Commands)</h3>
<p>Reduce network round trips by batching commands:</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Without pipelining (4 round trips)</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'value1'</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key2'</span><span class="token punctuation">,</span> <span class="token string">'value2'</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key3'</span><span class="token punctuation">,</span> <span class="token string">'value3'</span><span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key4'</span><span class="token punctuation">,</span> <span class="token string">'value4'</span><span class="token punctuation">)</span>

<span class="token comment"># With pipelining (1 round trip)</span>
pipe <span class="token operator">=</span> client<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key1'</span><span class="token punctuation">,</span> <span class="token string">'value1'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key2'</span><span class="token punctuation">,</span> <span class="token string">'value2'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key3'</span><span class="token punctuation">,</span> <span class="token string">'value3'</span><span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'key4'</span><span class="token punctuation">,</span> <span class="token string">'value4'</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> pipe<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Batch cache warming</span>
<span class="token keyword">def</span> <span class="token function">warm_cache</span><span class="token punctuation">(</span>user_ids<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pipe <span class="token operator">=</span> client<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> user_id <span class="token keyword">in</span> user_ids<span class="token punctuation">:</span>
        pipe<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'user:</span><span class="token interpolation"><span class="token punctuation">{</span>user_id<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> pipe<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> results
</code></pre>
<h2 id="monitoring-know-before-youre-paged">Monitoring: Know Before You’re Paged</h2>
<h3 id="key-metrics-to-watch">Key Metrics to Watch</h3>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">get_metrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    info <span class="token operator">=</span> client<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    metrics <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'memory_used_mb'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'used_memory'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">,</span>
        <span class="token string">'memory_peak_mb'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'used_memory_peak'</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">,</span>
        <span class="token string">'connected_clients'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'connected_clients'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'ops_per_sec'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'instantaneous_ops_per_sec'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'keyspace_hits'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'keyspace_hits'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'keyspace_misses'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'keyspace_misses'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'evicted_keys'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'evicted_keys'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'expired_keys'</span><span class="token punctuation">:</span> info<span class="token punctuation">[</span><span class="token string">'expired_keys'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment"># Calculate hit rate</span>
    total <span class="token operator">=</span> metrics<span class="token punctuation">[</span><span class="token string">'keyspace_hits'</span><span class="token punctuation">]</span> <span class="token operator">+</span> metrics<span class="token punctuation">[</span><span class="token string">'keyspace_misses'</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> total <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
        metrics<span class="token punctuation">[</span><span class="token string">'hit_rate'</span><span class="token punctuation">]</span> <span class="token operator">=</span> metrics<span class="token punctuation">[</span><span class="token string">'keyspace_hits'</span><span class="token punctuation">]</span> <span class="token operator">/</span> total <span class="token operator">*</span> <span class="token number">100</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        metrics<span class="token punctuation">[</span><span class="token string">'hit_rate'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    
    <span class="token keyword">return</span> metrics

<span class="token comment"># Check slow queries</span>
<span class="token keyword">def</span> <span class="token function">get_slow_queries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    slow_log <span class="token operator">=</span> client<span class="token punctuation">.</span>slowlog_get<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> entry <span class="token keyword">in</span> slow_log<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Duration: </span><span class="token interpolation"><span class="token punctuation">{</span>entry<span class="token punctuation">[</span><span class="token string">'duration'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">μs, Command: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>entry<span class="token punctuation">[</span><span class="token string">'command'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
<h3 id="alerts-to-set-up">Alerts to Set Up</h3>
<ol>
<li><strong>Memory > 80%</strong>: You’re about to start evicting keys</li>
<li><strong>Hit rate &#x3C; 80%</strong>: Cache isn’t effective, investigate</li>
<li><strong>Connected clients spiking</strong>: Possible connection leak</li>
<li><strong>Evicted keys > 0</strong> (if using <code>noeviction</code>): You’re out of memory</li>
<li><strong>Slow queries > 100ms</strong>: Something’s wrong</li>
</ol>
<h2 id="common-mistakes-that-will-ruin-your-day">Common Mistakes That Will Ruin Your Day</h2>
<h3 id="1-not-setting-maxmemory">1. Not Setting maxmemory</h3>
<p><strong>The problem:</strong> Valkey will consume all available RAM and crash your server.</p>
<p><strong>The fix:</strong></p>
<pre class="language-text" data-language="text"><code is:raw="" class="language-text">maxmemory 2gb
maxmemory-policy allkeys-lru
</code></pre>
<h3 id="2-using-valkey-as-a-primary-database">2. Using Valkey as a Primary Database</h3>
<p><strong>Don’t do this.</strong> Valkey is in-memory. Even with persistence, you can lose data. Use a durable database for storage, Valkey for caching.</p>
<h3 id="3-storing-large-objects">3. Storing Large Objects</h3>
<p><strong>The problem:</strong> Storing 100MB blobs kills performance. Valkey is optimized for &#x3C; 1MB values.</p>
<p><strong>The fix:</strong> Store large objects in S3/GCS, store the reference in Valkey:</p>
<pre class="language-python" data-language="python"><code is:raw="" class="language-python"><span class="token comment"># Instead of</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'video:123'</span><span class="token punctuation">,</span> large_video_bytes<span class="token punctuation">)</span>

<span class="token comment"># Use</span>
s3_url <span class="token operator">=</span> upload_to_s3<span class="token punctuation">(</span>large_video_bytes<span class="token punctuation">)</span>
client<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'video:123:url'</span><span class="token punctuation">,</span> s3_url<span class="token punctuation">)</span>
</code></pre>
<h3 id="4-not-using-connection-pooling">4. Not Using Connection Pooling</h3>
<p><strong>The problem:</strong> Creating connections is expensive. You’ll hit latency spikes.</p>
<p><strong>The fix:</strong> Use <code>ConnectionPool</code> (shown earlier).</p>
<h3 id="5-ignoring-persistence-trade-offs">5. Ignoring Persistence Trade-offs</h3>
<ul>
<li><strong>No persistence:</strong> Fastest, but lose all data on crash</li>
<li><strong>RDB only:</strong> Snapshots, can lose minutes of data</li>
<li><strong>AOF everysec:</strong> Lose max 1 second, good balance</li>
<li><strong>AOF always:</strong> Safest, but slow</li>
</ul>
<p>Choose based on your tolerance for data loss.</p>
<h2 id="final-thoughts">Final Thoughts</h2>
<p>If you’re starting a new project, concider Valkey. If you’re on Redis, <a href="/from-redis-to-valkey/">read the migration article</a> and plan your move. The ecosystem is moving on. The clouds are moving on. You should too.</p>
<p>Welcome to the post-Redis world. Caching is faster here.</p>
<p>Check the <a href="https://valkey.io/docs/">official Valkey docs</a> for deep dives.</p> </div>    <section class="related-posts" data-astro-cid-dpgbfi7r> <h2 data-astro-cid-dpgbfi7r>Related Posts</h2> <div class="related-posts-grid" data-astro-cid-dpgbfi7r> <article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/from-redis-to-valkey/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>Why We&#39;re Migrating from Redis to Valkey (and You Probably Should Too)</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>TL;DR In March 2024, Redis Ltd. changed their license from BSD to a proprietary dual-license (RSALv2/SSPLv1) to block…</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-11-21T00:00:00.000Z" data-astro-cid-dpgbfi7r> Nov 21, 2025 </time> <span data-astro-cid-dpgbfi7r>•</span> <span data-astro-cid-dpgbfi7r>8 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/ai-news/2025-11-29-mastering-terraform-file-structure-from-chaos-to-clean-architecture/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>Mastering Terraform File Structure – From Chaos to Clean Architecture</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>Why File Structure Matters in Terraform Terraform merges all files into a single configuration, but disorganized…</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-11-29T00:00:00.000Z" data-astro-cid-dpgbfi7r> Nov 29, 2025 </time> <span data-astro-cid-dpgbfi7r>•</span> <span data-astro-cid-dpgbfi7r>1 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/ai-news/2025-11-28-terraform-variables/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>Mastering Terraform Variables: Clean, Reusable Infrastructure Code</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>What Are Variables in Terraform? Terraform variables act as placeholders for reusable values, eliminating redundant…</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-11-28T00:00:00.000Z" data-astro-cid-dpgbfi7r> Nov 28, 2025 </time> <span data-astro-cid-dpgbfi7r>•</span> <span data-astro-cid-dpgbfi7r>1 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/python-sqlite-full-guide/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>Python and SQLite in the Real World</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>TL;DR – When to Use SQLite and When to Run Away SQLite is the most deployed database engine in the world, with billions…</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-11-22T00:00:00.000Z" data-astro-cid-dpgbfi7r> Nov 22, 2025 </time> <span data-astro-cid-dpgbfi7r>•</span> <span data-astro-cid-dpgbfi7r>23 min read</span> </div> </a> </article> </div> </section>  </article> </div> <div class="back-link" data-astro-cid-yvbahnfj><a href="/" data-astro-cid-yvbahnfj>← Back to home</a></div>  </main> <!-- Site Footer --> <footer class="site-footer container"> <p>
© 2025 AREZKI El Mehdi •
<a href="https://github.com/earezki">GitHub</a> •
<a href="/rss.xml">RSS</a> •
<a href="/tags/">Tags</a> •
<a href="/sitemap-index.xml">Sitemap</a> •
<button id="footer-subscribe-btn" class="footer-subscribe-btn" aria-label="Subscribe to newsletter">
📬 Subscribe
</button> </p> </footer> <!-- Footer Subscribe Button Handler --> <script type="module">const e=document.getElementById("themeToggle"),o=n=>{if(!e)return;const t=e.querySelector(".theme-icon");t&&(t.textContent=n==="dark"?"☀":"☾")};if(e){const n=document.documentElement.getAttribute("data-theme")||"dark";o(n),e.addEventListener("click",()=>{const t=document.documentElement,c=t.getAttribute("data-theme")==="dark"?"light":"dark";t.setAttribute("data-theme",c),localStorage.setItem("theme",c),o(c)})}</script> <!-- Theme Toggle --> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("footer-subscribe-btn");e&&e.addEventListener("click",n=>{n.preventDefault();const t=document.getElementById("subscription-popup");t&&(t.setAttribute("data-state","visible"),document.body.style.overflow="hidden")})});</script> <!-- Article read/unread tracking --> <script>
      (function() {
        const KEY = 'readArticles';
        
        function getRead() {
          try {
            const d = localStorage.getItem(KEY);
            return d ? JSON.parse(d) : [];
          } catch (e) {
            return [];
          }
        }
        
        function markRead(url) {
          try {
            const read = getRead();
            if (!read.includes(url)) {
              read.push(url);
              localStorage.setItem(KEY, JSON.stringify(read));
            }
          } catch (e) {}
        }
        
        function updateCards() {
          const read = new Set(getRead());
          const cards = document.querySelectorAll('.post-card[data-article-url]');
          cards.forEach(function(card) {
            const url = card.getAttribute('data-article-url');
            if (!url) return;
            const isRead = read.has(url);
            card.classList.toggle('read', isRead);
            card.classList.toggle('unread', !isRead);
          });
        }
        
        function markCurrent() {
          if (document.querySelector('.post-body')) {
            markRead(window.location.pathname);
          }
        }
        
        function init() {
          updateCards();
          markCurrent();
        }
        
        function clearRead(url) {
          try {
            const read = new Set(getRead());
            if (read.has(url)) {
              read.delete(url);
              localStorage.setItem(KEY, JSON.stringify(Array.from(read)));
              updateCards();
            }
          } catch (e) {}
        }
        
        window.clearReadArticle = clearRead;
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('pageshow', function(e) {
          if (e.persisted) init();
        });
      })();
    </script> <!-- Clear read button handler --> <script>
      (function() {
        document.addEventListener('click', function(e) {
          var tgt = e.target, btn = null;
          while (tgt && tgt !== document) {
            if (tgt.classList && tgt.classList.contains('clear-read-btn')) {
              btn = tgt;
              break;
            }
            tgt = tgt.parentNode;
          }
          if (!btn) return;
          e.preventDefault();
          e.stopPropagation();
          var url = btn.getAttribute('data-article-url');
          if (url && window.clearReadArticle) window.clearReadArticle(url);
        });
      })();
    </script> <!-- External links open in new tab --> <script>
      (function() {
        function makeExternal() {
          const domain = window.location.hostname;
          const links = document.querySelectorAll('a[href]');
          links.forEach(function(link) {
            const href = link.getAttribute('href');
            if (!href || link.hasAttribute('target')) return;
            const isExt = (href.startsWith('http://') || href.startsWith('https://')) && !href.includes(domain);
            if (isExt) {
              link.setAttribute('target', '_blank');
              link.setAttribute('rel', 'noopener noreferrer');
            }
          });
        }
        document.addEventListener('DOMContentLoaded', makeExternal);
        if (window.MutationObserver) {
          const obs = new MutationObserver(function(muts) {
            muts.forEach(function(mut) {
              if (mut.addedNodes.length) makeExternal();
            });
          });
          obs.observe(document.body, { childList: true, subtree: true });
        }
      })();
    </script> <!-- Code copy buttons --> <script>
      (function() {
        function createBtn() {
          const btn = document.createElement('button');
          btn.className = 'copy-code-button';
          btn.setAttribute('aria-label', 'Copy code to clipboard');
          btn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            <span>Copy</span>
          `;
          return btn;
        }
        
        function checkIcon() {
          return `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Copied!</span>
          `;
        }
        
        async function copyText(txt) {
          try {
            await navigator.clipboard.writeText(txt);
            return true;
          } catch (err) {
            const ta = document.createElement('textarea');
            ta.value = txt;
            ta.style.position = 'fixed';
            ta.style.left = '-999999px';
            document.body.appendChild(ta);
            ta.select();
            try {
              document.execCommand('copy');
              document.body.removeChild(ta);
              return true;
            } catch (e) {
              document.body.removeChild(ta);
              return false;
            }
          }
        }
        
        async function handleCopy(btn, code) {
          const txt = code.textContent || '';
          const ok = await copyText(txt);
          if (ok) {
            const orig = btn.innerHTML;
            btn.classList.add('copied');
            btn.innerHTML = checkIcon();
            setTimeout(function() {
              btn.classList.remove('copied');
              btn.innerHTML = orig;
            }, 2000);
          }
        }
        
        function addBtns() {
          const blocks = document.querySelectorAll('.post-body pre');
          blocks.forEach(function(pre) {
            if (pre.querySelector('.copy-code-button')) return;
            const btn = createBtn();
            const code = pre.querySelector('code');
            if (code) {
              btn.addEventListener('click', function() {
                handleCopy(btn, code);
              });
              pre.appendChild(btn);
            }
          });
        }
        
        document.addEventListener('DOMContentLoaded', addBtns);
      })();
    </script> <!-- Newsletter Subscription Popup --> <div id="subscription-popup" class="subscription-popup" data-state="hidden" data-auto-trigger="true" data-astro-cid-we5gmdnp> <div class="popup-overlay" id="popup-overlay" data-astro-cid-we5gmdnp></div> <div class="popup-container" data-astro-cid-we5gmdnp> <div class="popup-content" data-astro-cid-we5gmdnp> <div class="popup-icon" data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-we5gmdnp> <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-astro-cid-we5gmdnp></path> <polyline points="22,6 12,13 2,6" data-astro-cid-we5gmdnp></polyline> </svg> </div> <h2 class="popup-title" data-astro-cid-we5gmdnp>Stay Updated with Dev|Journal</h2> <p class="popup-description" id="popup-description" data-astro-cid-we5gmdnp>
Join our community of developers and engineers. Get insights on:
</p> <ul class="popup-features" data-astro-cid-we5gmdnp> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
Software Architecture & Design Patterns
</li> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
Backend Development Best Practices
</li> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
AI & Tech Industry Analysis
</li> </ul> <form id="subscription-form" class="popup-form" data-astro-cid-we5gmdnp> <div class="form-group" data-astro-cid-we5gmdnp> <input type="text" id="subscriber-name" name="name" placeholder="Your name" required autocomplete="name" data-astro-cid-we5gmdnp> </div> <div class="form-group" data-astro-cid-we5gmdnp> <input type="email" id="subscriber-email" name="email" placeholder="your.email@example.com" required autocomplete="email" data-astro-cid-we5gmdnp> </div> <div id="form-message" class="form-message" data-astro-cid-we5gmdnp></div> <div class="popup-actions" data-astro-cid-we5gmdnp> <button type="submit" class="btn btn-primary" id="subscribe-btn" data-astro-cid-we5gmdnp> <span class="btn-text" data-astro-cid-we5gmdnp>Subscribe</span> <span class="btn-loader" data-astro-cid-we5gmdnp> <svg class="spinner" viewBox="0 0 24 24" data-astro-cid-we5gmdnp> <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" data-astro-cid-we5gmdnp></circle> </svg> </span> </button> <button type="button" class="btn btn-secondary" id="not-now-btn" data-astro-cid-we5gmdnp>Not Now</button> <button type="button" class="btn btn-text" id="cancel-btn" data-astro-cid-we5gmdnp>Don't Show Again</button> </div> </form> </div> </div> </div>  <script>
  // Configuration
  const CONFIG = {
    graceDelay: 5000, // 5 seconds delay before showing popup
    notNowDelay: 24 * 60 * 60 * 1000, // 1 day in milliseconds
    apiUrl: 'https://api.earezki.com/blog/api',
  };

  const STORAGE_KEYS = {
    subscribed: 'newsletter_subscribed',
    cancelled: 'newsletter_cancelled',
    notNowUntil: 'newsletter_not_now_until',
  };

  // State management
  let popupTimeout = null;

  function showPopup() {
    const popup = document.getElementById('subscription-popup');
    if (popup) {
      popup.setAttribute('data-state', 'visible');
      document.body.style.overflow = 'hidden';
    }
  }

  function hidePopup() {
    const popup = document.getElementById('subscription-popup');
    if (popup) {
      popup.setAttribute('data-state', 'hidden');
      document.body.style.overflow = '';
    }
  }

  function shouldShowPopup() {
    // Check if user has already subscribed
    if (localStorage.getItem(STORAGE_KEYS.subscribed) === 'true') {
      return false;
    }

    // Check if user clicked "Don't show again"
    if (localStorage.getItem(STORAGE_KEYS.cancelled) === 'true') {
      return false;
    }

    // Check if user clicked "Not now" and delay hasn't passed
    const notNowUntil = localStorage.getItem(STORAGE_KEYS.notNowUntil);
    if (notNowUntil) {
      const notNowTime = parseInt(notNowUntil, 10);
      if (Date.now() < notNowTime) {
        return false;
      }
    }

    return true;
  }

  async function getSubscriberStats() {
    try {
      const response = await fetch(`${CONFIG.apiUrl}/subscribers/stats`, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
        },
      });
      
      if (!response.ok) {
        return null;
      }
      
      const data = await response.json();
      return data.subscriber_count || null;
    } catch (error) {
      console.error('Failed to fetch subscriber stats:', error);
      return null;
    }
  }

  async function schedulePopup() {
    if (!shouldShowPopup()) {
      return;
    }

    // Fetch subscriber stats before scheduling popup
    const subscriberCount = await getSubscriberStats();
    if (subscriberCount === null) {
      console.log('Failed to fetch subscriber stats, not showing subscription popup');
      return;
    }

    // Update popup with subscriber count
    updatePopupWithStats(subscriberCount);

    // Show popup after grace period
    popupTimeout = window.setTimeout(() => {
      showPopup();
    }, CONFIG.graceDelay);
  }

  function updatePopupWithStats(count) {
    const descriptionEl = document.querySelector('.popup-description');
    if (descriptionEl) {
      const formattedCount = new Intl.NumberFormat('en-US').format(count);
      descriptionEl.innerHTML = `Join a community of <strong>${formattedCount}+</strong> developers and engineers who are growing together. Get insights on:`;
    }
  }

  async function handleSubscribe(event) {
    event.preventDefault();
    
    const form = event.target;
    const nameInput = form.querySelector('#subscriber-name');
    const emailInput = form.querySelector('#subscriber-email');
    const submitBtn = form.querySelector('#subscribe-btn');
    const messageEl = document.getElementById('form-message');

    const name = nameInput.value.trim();
    const email = emailInput.value.trim();

    if (!name || !email) {
      if (messageEl) {
        messageEl.textContent = 'Please fill in all fields.';
        messageEl.className = 'form-message error';
      }
      return;
    }

    // Show loading state
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    if (messageEl) {
      messageEl.textContent = '';
      messageEl.className = 'form-message';
    }

    try {
      const response = await fetch(`${CONFIG.apiUrl}/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ name, email }),
      });

      const data = await response.json();

      if (data.success) {
        localStorage.setItem(STORAGE_KEYS.subscribed, 'true');
        
        if (messageEl) {
          messageEl.textContent = '🎉 Successfully subscribed! Thank you for joining us.';
          messageEl.className = 'form-message success';
        }

        // Hide popup after 2 seconds
        setTimeout(() => {
          hidePopup();
        }, 2000);
      } else {
        if (messageEl) {
          messageEl.textContent = data.error || 'Subscription failed. Please try again.';
          messageEl.className = 'form-message error';
        }
      }
    } catch (error) {
      console.error('Subscription error:', error);
      if (messageEl) {
        messageEl.textContent = 'Network error. Please check your connection and try again.';
        messageEl.className = 'form-message error';
      }
    } finally {
      submitBtn.classList.remove('loading');
      submitBtn.disabled = false;
    }
  }

  function handleNotNow() {
    const notNowUntil = Date.now() + CONFIG.notNowDelay;
    localStorage.setItem(STORAGE_KEYS.notNowUntil, notNowUntil.toString());
    hidePopup();
  }

  function handleCancel() {
    localStorage.setItem(STORAGE_KEYS.cancelled, 'true');
    hidePopup();
  }

  // Initialize popup
  document.addEventListener('DOMContentLoaded', () => {
    const popup = document.getElementById('subscription-popup');
    const autoTrigger = popup?.getAttribute('data-auto-trigger') === 'true';
    
    // Schedule popup to show after grace period only if autoTrigger is enabled
    if (autoTrigger) {
      schedulePopup();
    }

    // Event listeners
    const form = document.getElementById('subscription-form');
    const overlay = document.getElementById('popup-overlay');
    const notNowBtn = document.getElementById('not-now-btn');
    const cancelBtn = document.getElementById('cancel-btn');

    if (form) {
      form.addEventListener('submit', handleSubscribe);
    }

    if (overlay) {
      overlay.addEventListener('click', handleNotNow);
    }

    if (notNowBtn) {
      notNowBtn.addEventListener('click', handleNotNow);
    }

    if (cancelBtn) {
      cancelBtn.addEventListener('click', handleCancel);
    }

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      if (popupTimeout) {
        clearTimeout(popupTimeout);
      }
    });
  });
</script> </body></html> 