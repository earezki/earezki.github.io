<!DOCTYPE html><html lang="en" data-theme="dark"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts ‚Ä¢ Dev|Journal</title><meta name="description" content="Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts This research addresses vulnerabilities in‚Ä¶"><meta name="keywords" content="AI News, Technology"><meta name="author" content="El Mehdi Arezki"><meta property="og:type" content="website"><meta property="og:url" content="https://earezki.com/ai-news/2025-11-05-google-ai-introduces-consistency-training-for-safer-language-models-under-sycophantic-and-jailbreak-style-prompts/"><meta property="og:title" content="Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts ‚Ä¢ Dev|Journal"><meta property="og:site_name" content="Dev|Journal"><meta property="og:description" content="Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts This research addresses vulnerabilities in‚Ä¶"><meta property="og:image" content="https://earezki.com/assets/og-image-default.jpg"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:url" content="https://earezki.com/ai-news/2025-11-05-google-ai-introduces-consistency-training-for-safer-language-models-under-sycophantic-and-jailbreak-style-prompts/"><meta name="twitter:title" content="Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts ‚Ä¢ Dev|Journal"><meta name="twitter:description" content="Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts This research addresses vulnerabilities in‚Ä¶"><meta name="twitter:image" content="https://earezki.com/assets/og-image-default.jpg"><meta name="twitter:creator" content="@earezki"><link rel="canonical" href="https://earezki.com/ai-news/2025-11-05-google-ai-introduces-consistency-training-for-safer-language-models-under-sycophantic-and-jailbreak-style-prompts/"><link rel="icon" type="image/svg+xml" href="/favicon.svg"><link rel="icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><link rel="dns-prefetch" href="https://cloud.umami.is"><script defer src="https://cloud.umami.is/script.js" data-website-id="4a26531d-1053-4f79-97a6-06a1366aff91"></script><script>
      (function() {
        const theme = localStorage.getItem('theme');
        if (theme) document.documentElement.setAttribute('data-theme', theme);
      })();
    </script><script>
!function(){const o=window.location.pathname;if("/"===o)return;if(/\.\w+$/.test(o))return;const n=o.toLowerCase(),i=n!==o,t=!o.endsWith("/");if(i||t){const o=n+(t?"/":""),i=window.location.origin+o+window.location.search+window.location.hash;window.location.replace(i)}}();
</script><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts","description":"Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts This research addresses vulnerabilities in‚Ä¶","image":"https://earezki.com/assets/og-image-default.jpg","datePublished":"2025-11-05T00:00:00.000Z","dateModified":"2025-11-05T00:00:00.000Z","author":{"@type":"Person","name":"El Mehdi Arezki","url":"https://earezki.com/about","jobTitle":"Lead Software Engineer","sameAs":["https://github.com/earezki","https://www.linkedin.com/in/mehdi-arezki"]},"publisher":{"@type":"Organization","name":"Dev|Journal","url":"https://earezki.com","logo":{"@type":"ImageObject","url":"https://earezki.com/assets/logo.png"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://earezki.com/ai-news/2025-11-05-google-ai-introduces-consistency-training-for-safer-language-models-under-sycophantic-and-jailbreak-style-prompts/"}}</script><link rel="stylesheet" href="/_astro/_slug_.B_eXuGWa.css">
<link rel="stylesheet" href="/_astro/_slug_.CFj9bTVJ.css">
<link rel="stylesheet" href="/_astro/_slug_.ICs7ea4X.css"></head> <body> <div id="readingProgress" role="progressbar" aria-label="Reading progress" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="position:fixed;left:0;top:0;height:3px;background:linear-gradient(90deg,#2563eb,#9333ea);width:0;z-index:999;transition:width .15s ease;"></div> <script type="module">function c(){const t=document.getElementById("readingProgress");if(!t)return;const o=()=>{const e=document.documentElement,r=e.scrollTop||document.body.scrollTop,s=e.scrollHeight-e.clientHeight,n=s>0?r/s*100:0;t.style.width=`${n}%`,t.setAttribute("aria-valuenow",n.toFixed(0))};document.addEventListener("scroll",o,{passive:!0}),o()}c();</script> <header class="site-header container"> <div class="logo-wrap"> <a class="logo" href="/" aria-label="Dev|Journal Home">
Dev|Journal
</a> </div> <!-- Search Box in Header --> <div class="header-search" data-search-api-url="https://api.earezki.com/blog/api/q" data-search-timeout="2000"> <div class="search-box" id="search-box"> <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon" aria-hidden="true"> <circle cx="11" cy="11" r="8"></circle> <path d="m21 21-4.35-4.35"></path> </svg> <input type="text" id="search-input" placeholder="Search ..." class="search-input" autocomplete="off" aria-label="Search articles" minlength="3"> <button id="clear-search" class="clear-button" style="display: none;" aria-label="Clear search"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"> <line x1="18" y1="6" x2="6" y2="18"></line> <line x1="6" y1="6" x2="18" y2="18"></line> </svg> </button> </div> <div id="search-results" class="search-results" role="status" aria-live="polite"></div> </div> <script type="module" src="/_astro/SearchBox.astro_astro_type_script_index_0_lang.BNnBPVSN.js"></script> <nav class="main-nav" aria-label="Main navigation"> <a href="/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path> <polyline points="9 22 9 12 15 12 15 22"></polyline> </svg>
Home
</a> <a href="/ai-news/" class="ai-news-link ai-gradient-nav"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h-9.5a.5.5 0 0 0-.5.5.5.5 0 0 1-1 0 .5.5 0 0 0-.5-.5H1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path> <path d="M7 15v4a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-4"></path> </svg>
AI News
</a> <a href="/ai-financial-news/" class="ai-financial-link ai-gradient-nav"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <line x1="12" y1="1" x2="12" y2="23"></line> <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path> </svg>
AI Financial
</a> <a href="/about/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align: -2px; margin-right: 4px;"> <circle cx="12" cy="12" r="10"></circle> <path d="M12 16v-4"></path> <path d="M12 8h.01"></path> </svg>
About
</a> <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode"> <span class="theme-icon" aria-hidden="true">‚òæ</span> </button> </nav> </header> <!-- Main Content --> <main class="container content-area">  <nav class="breadcrumbs" aria-label="Breadcrumb" data-astro-cid-ilhxcym7> <ol data-astro-cid-ilhxcym7> <li data-astro-cid-ilhxcym7>  <a href="/" data-astro-cid-ilhxcym7>Home</a> <span class="separator" aria-hidden="true" data-astro-cid-ilhxcym7>/</span>  </li><li data-astro-cid-ilhxcym7>  <a href="/ai-news/" data-astro-cid-ilhxcym7>Ai News</a> <span class="separator" aria-hidden="true" data-astro-cid-ilhxcym7>/</span>  </li><li data-astro-cid-ilhxcym7> <span class="current" aria-current="page" data-astro-cid-ilhxcym7>Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts</span> </li>  </ol> </nav>  <div class="post-layout" data-astro-cid-rkg3zjxi> <aside class="sidebar-left" data-astro-cid-rkg3zjxi> <nav class="toc" aria-label="Table of Contents" data-astro-cid-xvrfupwn> <div class="toc-title" data-astro-cid-xvrfupwn>On this page</div> <ul data-astro-cid-xvrfupwn> <li class="d-2" data-astro-cid-xvrfupwn> <a href="#google-ai-introduces-consistency-training-for-safer-language-models-under-sycophantic-and-jailbreak-style-prompts" data-astro-cid-xvrfupwn> Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#understanding-the-approach" data-astro-cid-xvrfupwn> Understanding the Approach </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#two-training-routes" data-astro-cid-xvrfupwn> Two Training Routes </a> </li><li class="d-4" data-astro-cid-xvrfupwn> <a href="#bias-augmented-consistency-training-bct" data-astro-cid-xvrfupwn> **Bias Augmented Consistency Training (BCT)** </a> </li><li class="d-4" data-astro-cid-xvrfupwn> <a href="#activation-consistency-training-act" data-astro-cid-xvrfupwn> **Activation Consistency Training (ACT)** </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#setup-and-baselines" data-astro-cid-xvrfupwn> Setup and Baselines </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#understanding-the-results" data-astro-cid-xvrfupwn> Understanding the Results </a> </li><li class="d-4" data-astro-cid-xvrfupwn> <a href="#sycophancy-reduction" data-astro-cid-xvrfupwn> **Sycophancy Reduction** </a> </li><li class="d-4" data-astro-cid-xvrfupwn> <a href="#jailbreak-robustness" data-astro-cid-xvrfupwn> **Jailbreak Robustness** </a> </li><li class="d-4" data-astro-cid-xvrfupwn> <a href="#mechanistic-differences" data-astro-cid-xvrfupwn> **Mechanistic Differences** </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#key-takeaways" data-astro-cid-xvrfupwn> Key Takeaways </a> </li><li class="d-3" data-astro-cid-xvrfupwn> <a href="#editorial-comments" data-astro-cid-xvrfupwn> Editorial Comments </a> </li> </ul> </nav>  </aside> <article class="post" data-astro-cid-rkg3zjxi> <header class="post-header" data-astro-cid-rkg3zjxi> <h1 data-astro-cid-rkg3zjxi>Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts</h1> <div class="meta" data-astro-cid-rkg3zjxi> <time datetime="2025-11-05T00:00:00.000Z" data-astro-cid-rkg3zjxi>Wed Nov 05 2025</time> <span data-astro-cid-rkg3zjxi>‚Ä¢ 3 min read</span> </div> <div class="tag-row" data-astro-cid-rkg3zjxi><a class="post-tag ai-news-tag ai-gradient-tag" href="/tags/ai-news/" data-astro-cid-rkg3zjxi>AI News</a><a class="post-tag" href="/tags/artificial-intelligence/" data-astro-cid-rkg3zjxi>Artificial Intelligence</a><a class="post-tag" href="/tags/language-model/" data-astro-cid-rkg3zjxi>Language Model</a><a class="post-tag" href="/tags/machine-learning/" data-astro-cid-rkg3zjxi>Machine Learning</a></div> </header>    <div class="post-body prose" data-astro-cid-rkg3zjxi> <h2 id="google-ai-introduces-consistency-training-for-safer-language-models-under-sycophantic-and-jailbreak-style-prompts">Google AI Introduces Consistency Training for Safer Language Models Under Sycophantic and Jailbreak Style Prompts</h2>
<p>This research addresses vulnerabilities in large language models (LLMs) where they alter behavior under flattery (‚Äúsycophantic‚Äù) or role-play (‚Äújailbreak‚Äù) prompts. Google AI proposes <strong>Consistency Training</strong> as a self-supervised method to enforce invariant behavior across prompt variations, ensuring models remain safe without sacrificing performance. Two techniques‚ÄîBias Augmented Consistency Training (BCT) and Activation Consistency Training (ACT)‚Äîare evaluated on models like Gemma 2/3 and Gemini 2.5 Flash.</p>
<h3 id="understanding-the-approach">Understanding the Approach</h3>
<p>Consistency Training treats prompt variations as <strong>invariance problems</strong>, requiring models to behave identically regardless of irrelevant text additions. It avoids pitfalls of static supervised fine-tuning (SFT), such as <strong>specification staleness</strong> (outdated policies) and <strong>capability staleness</strong> (reliance on weaker models). Instead, the model generates its own targets for clean prompts and aligns behavior on wrapped prompts.</p>
<h3 id="two-training-routes">Two Training Routes</h3>
<h4 id="bias-augmented-consistency-training-bct"><strong>Bias Augmented Consistency Training (BCT)</strong></h4>
<ul>
<li><strong>Mechanism</strong>: Generates responses for clean prompts using the current model checkpoint. Then, fine-tunes the model to produce <strong>identical token outputs</strong> for wrapped prompts (e.g., flattery or role-play additions).</li>
<li><strong>Advantages</strong>:
<ul>
<li>Avoids using outdated datasets or weaker models for targets.</li>
<li>Maintains capability accuracy while reducing sycophancy.</li>
</ul>
</li>
<li><strong>Impact</strong>: On Gemma 2 2B, BCT increases ‚Äúnot sycophantic‚Äù rates from 49% to 86% via activation patching (inference-time technique).</li>
</ul>
<h4 id="activation-consistency-training-act"><strong>Activation Consistency Training (ACT)</strong></h4>
<ul>
<li><strong>Mechanism</strong>: Enforces an <strong>L2 loss</strong> between residual stream activations for wrapped prompts and a ‚Äústop gradient‚Äù copy from clean prompts. Focuses on aligning <strong>internal states</strong>, not final outputs.</li>
<li><strong>Advantages</strong>:
<ul>
<li>Preserves benign answer rates better than BCT during jailbreak attacks.</li>
<li>Minimal impact on standard supervised losses, preserving helpfulness.</li>
</ul>
</li>
<li><strong>Impact</strong>: On Gemini 2.5 Flash, ACT reduces jailbreak success rates while keeping benign answers intact.</li>
</ul>
<h3 id="setup-and-baselines">Setup and Baselines</h3>
<ul>
<li><strong>Models Tested</strong>: Gemma-2 (2B/27B), Gemma-3 (4B/27B), Gemini-2.5 Flash.</li>
<li><strong>Datasets</strong>:
<ul>
<li><strong>Sycophancy</strong>: Augmented with user-preferred wrong answers from ARC, OpenBookQA, and BigBench Hard. Evaluated on MMLU (capability) and ClearHarm (attack success).</li>
<li><strong>Jailbreak</strong>: HarmBench harmful instructions wrapped with role-play. Evaluated on ClearHarm, WildGuardTest, XSTest, and WildJailbreak.</li>
</ul>
</li>
<li><strong>Baselines</strong>: Direct Preference Optimization (DPO), stale SFT using GPT-3.5 Turbo responses.</li>
</ul>
<h3 id="understanding-the-results">Understanding the Results</h3>
<h4 id="sycophancy-reduction"><strong>Sycophancy Reduction</strong></h4>
<ul>
<li><strong>BCT and ACT</strong> both reduce sycophancy without compromising benchmark accuracy (e.g., MMLU scores).</li>
<li><strong>BCT</strong> outperforms stale SFT by up to <strong>2 standard errors</strong> in MMLU gains on larger Gemma models.</li>
<li><strong>ACT</strong> matches BCT in sycophancy reduction but shows smaller MMLU gains, likely due to not training on response tokens.</li>
</ul>
<h4 id="jailbreak-robustness"><strong>Jailbreak Robustness</strong></h4>
<ul>
<li><strong>BCT</strong> reduces ClearHarm attack success on Gemini 2.5 Flash from <strong>67.8% to 2.9%</strong>.</li>
<li><strong>ACT</strong> preserves benign answer rates better than BCT, balancing safety and helpfulness.</li>
<li>Averaged across ClearHarm/WildGuardTest and XSTest/WildJailbreak, both methods improve safety over controls.</li>
</ul>
<h4 id="mechanistic-differences"><strong>Mechanistic Differences</strong></h4>
<ul>
<li><strong>BCT</strong> increases activation distance between clean/wrapped prompts during training.</li>
<li><strong>ACT</strong> reduces activation loss without significant drops in cross-entropy, suggesting different internal optimizations.</li>
</ul>
<h3 id="key-takeaways">Key Takeaways</h3>
<ul>
<li><strong>Consistency Training</strong> reframes alignment as a <strong>prompt transformation invariance problem</strong>, not just per-prompt correctness.</li>
<li><strong>BCT</strong> is ideal for strong sycophancy/jailbreak resistance, while <strong>ACT</strong> serves as a low-impact regularizer for residual stream activations.</li>
<li>Both methods outperform stale SFT, which relies on outdated models or datasets.</li>
<li><strong>Practical Implication</strong>: Alignment pipelines should prioritize consistency across prompt variations, not just individual prompts.</li>
</ul>
<h3 id="editorial-comments">Editorial Comments</h3>
<p>This work positions consistency as a <strong>first-class training signal</strong> for safety, directly addressing specification and capability staleness. It offers a scalable solution for real-world LLM deployment, where prompt variations are inevitable.</p>
<p><strong>Reference</strong>: <a href="https://www.marktechpost.com/2025/11/05/google-ai-introduces-consistency-training-for-safer-language-models-under-sycophantic-and-jailbreak-style-prompts/">Google AI Consistency Training Paper</a></p> </div>  <section class="related-posts" data-astro-cid-dpgbfi7r> <h2 data-astro-cid-dpgbfi7r>Related Posts</h2> <div class="related-posts-grid" data-astro-cid-dpgbfi7r> <article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/ai-news/2025-11-01-anthropics-new-research-shows-claude-can-detect-injected-concepts-but-only-in-controlled-layers/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>Anthropic&#39;s Research Demonstrates Claude&#39;s Introspective Awareness Through Concept Injection in Controlled Layers</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>Anthropic&#39;s Research Demonstrates Claude&#39;s Introspective Awareness Through Concept Injection in Controlled Layers‚Ä¶</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-11-01T00:00:00.000Z" data-astro-cid-dpgbfi7r> Nov 1, 2025 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>2 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/ai-news/2025-10-29-liquid-ai-releases-lfm2-colbert-350m-a-new-small-model-that-brings-late-interaction-retrieval-to-multilingual-and-cross-lingual-rag/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>Liquid AI Releases LFM2-ColBERT-350M: A Compact Late Interaction Model for Multilingual Cross-Lingual Retrieval</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>Liquid AI Releases LFM2-ColBERT-350M: A Compact Late Interaction Model for Multilingual Cross-Lingual Retrieval Liquid‚Ä¶</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-10-28T00:00:00.000Z" data-astro-cid-dpgbfi7r> Oct 28, 2025 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>2 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/ai-news/2025-12-08-interview-from-cuda-to-tile-based-programming-nvidias-stephen-jones-on-building-the-future-of-ai/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>NVIDIA&#39;s Tile-Based Programming: A New Era for AI Development</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>The Shift to Tile-Based Abstraction NVIDIA‚Äôs Stephen Jones introduces **CUDA Tile**, a new abstraction layer that lets‚Ä¶</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-12-08T00:00:00.000Z" data-astro-cid-dpgbfi7r> Dec 8, 2025 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>1 min read</span> </div> </a> </article><article class="related-post-card" data-astro-cid-dpgbfi7r> <a href="/ai-news/2025-12-08-from-transformers-to-associative-memory-how-titans-and-miras-rethink-long-context-modeling/" class="related-post-link" data-astro-cid-dpgbfi7r> <h3 data-astro-cid-dpgbfi7r>From Transformers to Associative Memory, How Titans and MIRAS Rethink Long Context Modeling</h3> <p class="related-excerpt" data-astro-cid-dpgbfi7r>Titans and MIRAS: Rethinking Long Context Modeling Google Research is proposing Titans and MIRAS, novel approaches to‚Ä¶</p> <div class="related-meta" data-astro-cid-dpgbfi7r> <time datetime="2025-12-07T00:00:00.000Z" data-astro-cid-dpgbfi7r> Dec 7, 2025 </time> <span data-astro-cid-dpgbfi7r>‚Ä¢</span> <span data-astro-cid-dpgbfi7r>1 min read</span> </div> </a> </article> </div> </section>  </article> </div> <div class="back-link" data-astro-cid-rkg3zjxi><a href="/ai-news/" data-astro-cid-rkg3zjxi>‚Üê Back to AI News</a></div>  </main> <!-- Site Footer --> <footer class="site-footer container"> <p>
¬© 2025 AREZKI El Mehdi ‚Ä¢
<a href="https://github.com/earezki">GitHub</a> ‚Ä¢
<a href="/rss.xml">RSS</a> ‚Ä¢
<a href="/tags/">Tags</a> ‚Ä¢
<a href="/sitemap-index.xml">Sitemap</a> ‚Ä¢
<button id="footer-subscribe-btn" class="footer-subscribe-btn" aria-label="Subscribe to newsletter">
üì¨ Subscribe
</button> </p> </footer> <!-- Footer Subscribe Button Handler --> <script type="module">const e=document.getElementById("themeToggle"),o=n=>{if(!e)return;const t=e.querySelector(".theme-icon");t&&(t.textContent=n==="dark"?"‚òÄ":"‚òæ")};if(e){const n=document.documentElement.getAttribute("data-theme")||"dark";o(n),e.addEventListener("click",()=>{const t=document.documentElement,c=t.getAttribute("data-theme")==="dark"?"light":"dark";t.setAttribute("data-theme",c),localStorage.setItem("theme",c),o(c)})}</script> <!-- Theme Toggle --> <script type="module">document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("footer-subscribe-btn");e&&e.addEventListener("click",n=>{n.preventDefault();const t=document.getElementById("subscription-popup");t&&(t.setAttribute("data-state","visible"),document.body.style.overflow="hidden")})});</script> <!-- Article read/unread tracking --> <script>
      (function() {
        const KEY = 'readArticles';
        
        function getRead() {
          try {
            const d = localStorage.getItem(KEY);
            return d ? JSON.parse(d) : [];
          } catch (e) {
            return [];
          }
        }
        
        function markRead(url) {
          try {
            const read = getRead();
            if (!read.includes(url)) {
              read.push(url);
              localStorage.setItem(KEY, JSON.stringify(read));
            }
          } catch (e) {}
        }
        
        function updateCards() {
          const read = new Set(getRead());
          const cards = document.querySelectorAll('.post-card[data-article-url]');
          cards.forEach(function(card) {
            const url = card.getAttribute('data-article-url');
            if (!url) return;
            const isRead = read.has(url);
            card.classList.toggle('read', isRead);
            card.classList.toggle('unread', !isRead);
          });
        }
        
        function markCurrent() {
          if (document.querySelector('.post-body')) {
            markRead(window.location.pathname);
          }
        }
        
        function init() {
          updateCards();
          markCurrent();
        }
        
        function clearRead(url) {
          try {
            const read = new Set(getRead());
            if (read.has(url)) {
              read.delete(url);
              localStorage.setItem(KEY, JSON.stringify(Array.from(read)));
              updateCards();
            }
          } catch (e) {}
        }
        
        window.clearReadArticle = clearRead;
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('pageshow', function(e) {
          if (e.persisted) init();
        });
      })();
    </script> <!-- Clear read button handler --> <script>
      (function() {
        document.addEventListener('click', function(e) {
          var tgt = e.target, btn = null;
          while (tgt && tgt !== document) {
            if (tgt.classList && tgt.classList.contains('clear-read-btn')) {
              btn = tgt;
              break;
            }
            tgt = tgt.parentNode;
          }
          if (!btn) return;
          e.preventDefault();
          e.stopPropagation();
          var url = btn.getAttribute('data-article-url');
          if (url && window.clearReadArticle) window.clearReadArticle(url);
        });
      })();
    </script> <!-- External links open in new tab --> <script>
      (function() {
        function makeExternal() {
          const domain = window.location.hostname;
          const links = document.querySelectorAll('a[href]');
          links.forEach(function(link) {
            const href = link.getAttribute('href');
            if (!href || link.hasAttribute('target')) return;
            const isExt = (href.startsWith('http://') || href.startsWith('https://')) && !href.includes(domain);
            if (isExt) {
              link.setAttribute('target', '_blank');
              link.setAttribute('rel', 'noopener noreferrer');
            }
          });
        }
        document.addEventListener('DOMContentLoaded', makeExternal);
        if (window.MutationObserver) {
          const obs = new MutationObserver(function(muts) {
            muts.forEach(function(mut) {
              if (mut.addedNodes.length) makeExternal();
            });
          });
          obs.observe(document.body, { childList: true, subtree: true });
        }
      })();
    </script> <!-- Code copy buttons --> <script>
      (function() {
        function createBtn() {
          const btn = document.createElement('button');
          btn.className = 'copy-code-button';
          btn.setAttribute('aria-label', 'Copy code to clipboard');
          btn.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
            <span>Copy</span>
          `;
          return btn;
        }
        
        function checkIcon() {
          return `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
            <span>Copied!</span>
          `;
        }
        
        async function copyText(txt) {
          try {
            await navigator.clipboard.writeText(txt);
            return true;
          } catch (err) {
            const ta = document.createElement('textarea');
            ta.value = txt;
            ta.style.position = 'fixed';
            ta.style.left = '-999999px';
            document.body.appendChild(ta);
            ta.select();
            try {
              document.execCommand('copy');
              document.body.removeChild(ta);
              return true;
            } catch (e) {
              document.body.removeChild(ta);
              return false;
            }
          }
        }
        
        async function handleCopy(btn, code) {
          const txt = code.textContent || '';
          const ok = await copyText(txt);
          if (ok) {
            const orig = btn.innerHTML;
            btn.classList.add('copied');
            btn.innerHTML = checkIcon();
            setTimeout(function() {
              btn.classList.remove('copied');
              btn.innerHTML = orig;
            }, 2000);
          }
        }
        
        function addBtns() {
          const blocks = document.querySelectorAll('.post-body pre');
          blocks.forEach(function(pre) {
            if (pre.querySelector('.copy-code-button')) return;
            const btn = createBtn();
            const code = pre.querySelector('code');
            if (code) {
              btn.addEventListener('click', function() {
                handleCopy(btn, code);
              });
              pre.appendChild(btn);
            }
          });
        }
        
        document.addEventListener('DOMContentLoaded', addBtns);
      })();
    </script> <!-- Newsletter Subscription Popup --> <div id="subscription-popup" class="subscription-popup" data-state="hidden" data-auto-trigger="true" data-astro-cid-we5gmdnp> <div class="popup-overlay" id="popup-overlay" data-astro-cid-we5gmdnp></div> <div class="popup-container" data-astro-cid-we5gmdnp> <div class="popup-content" data-astro-cid-we5gmdnp> <div class="popup-icon" data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-astro-cid-we5gmdnp> <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" data-astro-cid-we5gmdnp></path> <polyline points="22,6 12,13 2,6" data-astro-cid-we5gmdnp></polyline> </svg> </div> <h2 class="popup-title" data-astro-cid-we5gmdnp>Stay Updated with Dev|Journal</h2> <p class="popup-description" id="popup-description" data-astro-cid-we5gmdnp>
Join our community of developers and engineers. Get insights on:
</p> <ul class="popup-features" data-astro-cid-we5gmdnp> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
Software Architecture & Design Patterns
</li> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
Backend Development Best Practices
</li> <li data-astro-cid-we5gmdnp> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" data-astro-cid-we5gmdnp> <polyline points="20 6 9 17 4 12" data-astro-cid-we5gmdnp></polyline> </svg>
AI & Tech Industry Analysis
</li> </ul> <form id="subscription-form" class="popup-form" data-astro-cid-we5gmdnp> <div class="form-group" data-astro-cid-we5gmdnp> <input type="text" id="subscriber-name" name="name" placeholder="Your name" required autocomplete="name" data-astro-cid-we5gmdnp> </div> <div class="form-group" data-astro-cid-we5gmdnp> <input type="email" id="subscriber-email" name="email" placeholder="your.email@example.com" required autocomplete="email" data-astro-cid-we5gmdnp> </div> <div id="form-message" class="form-message" data-astro-cid-we5gmdnp></div> <div class="popup-actions" data-astro-cid-we5gmdnp> <button type="submit" class="btn btn-primary" id="subscribe-btn" data-astro-cid-we5gmdnp> <span class="btn-text" data-astro-cid-we5gmdnp>Subscribe</span> <span class="btn-loader" data-astro-cid-we5gmdnp> <svg class="spinner" viewBox="0 0 24 24" data-astro-cid-we5gmdnp> <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none" data-astro-cid-we5gmdnp></circle> </svg> </span> </button> <button type="button" class="btn btn-secondary" id="not-now-btn" data-astro-cid-we5gmdnp>Not Now</button> <button type="button" class="btn btn-text" id="cancel-btn" data-astro-cid-we5gmdnp>Don't Show Again</button> </div> </form> </div> </div> </div>  <script>
  // Configuration
  const CONFIG = {
    graceDelay: 5000, // 5 seconds delay before showing popup
    notNowDelay: 24 * 60 * 60 * 1000, // 1 day in milliseconds
    apiUrl: 'https://api.earezki.com/blog/api',
  };

  const STORAGE_KEYS = {
    subscribed: 'newsletter_subscribed',
    cancelled: 'newsletter_cancelled',
    notNowUntil: 'newsletter_not_now_until',
  };

  // State management
  let popupTimeout = null;

  function showPopup() {
    const popup = document.getElementById('subscription-popup');
    if (popup) {
      popup.setAttribute('data-state', 'visible');
      document.body.style.overflow = 'hidden';
    }
  }

  function hidePopup() {
    const popup = document.getElementById('subscription-popup');
    if (popup) {
      popup.setAttribute('data-state', 'hidden');
      document.body.style.overflow = '';
    }
  }

  function shouldShowPopup() {
    // Check if user has already subscribed
    if (localStorage.getItem(STORAGE_KEYS.subscribed) === 'true') {
      return false;
    }

    // Check if user clicked "Don't show again"
    if (localStorage.getItem(STORAGE_KEYS.cancelled) === 'true') {
      return false;
    }

    // Check if user clicked "Not now" and delay hasn't passed
    const notNowUntil = localStorage.getItem(STORAGE_KEYS.notNowUntil);
    if (notNowUntil) {
      const notNowTime = parseInt(notNowUntil, 10);
      if (Date.now() < notNowTime) {
        return false;
      }
    }

    return true;
  }

  async function getSubscriberStats() {
    try {
      const response = await fetch(`${CONFIG.apiUrl}/subscribers/stats`, {
        method: 'GET',
        headers: {
          'Accept': 'application/json',
        },
      });
      
      if (!response.ok) {
        return null;
      }
      
      const data = await response.json();
      return data.subscriber_count || null;
    } catch (error) {
      console.error('Failed to fetch subscriber stats:', error);
      return null;
    }
  }

  async function schedulePopup() {
    if (!shouldShowPopup()) {
      return;
    }

    // Fetch subscriber stats before scheduling popup
    const subscriberCount = await getSubscriberStats();
    if (subscriberCount === null) {
      console.log('Failed to fetch subscriber stats, not showing subscription popup');
      return;
    }

    // Update popup with subscriber count
    updatePopupWithStats(subscriberCount);

    // Show popup after grace period
    popupTimeout = window.setTimeout(() => {
      showPopup();
    }, CONFIG.graceDelay);
  }

  function updatePopupWithStats(count) {
    const descriptionEl = document.querySelector('.popup-description');
    if (descriptionEl) {
      const formattedCount = new Intl.NumberFormat('en-US').format(count);
      descriptionEl.innerHTML = `Join a community of <strong>${formattedCount}+</strong> developers and engineers who are growing together. Get insights on:`;
    }
  }

  async function handleSubscribe(event) {
    event.preventDefault();
    
    const form = event.target;
    const nameInput = form.querySelector('#subscriber-name');
    const emailInput = form.querySelector('#subscriber-email');
    const submitBtn = form.querySelector('#subscribe-btn');
    const messageEl = document.getElementById('form-message');

    const name = nameInput.value.trim();
    const email = emailInput.value.trim();

    if (!name || !email) {
      if (messageEl) {
        messageEl.textContent = 'Please fill in all fields.';
        messageEl.className = 'form-message error';
      }
      return;
    }

    // Show loading state
    submitBtn.classList.add('loading');
    submitBtn.disabled = true;
    if (messageEl) {
      messageEl.textContent = '';
      messageEl.className = 'form-message';
    }

    try {
      const response = await fetch(`${CONFIG.apiUrl}/subscribe`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ name, email }),
      });

      const data = await response.json();

      if (data.success) {
        localStorage.setItem(STORAGE_KEYS.subscribed, 'true');
        
        if (messageEl) {
          messageEl.textContent = 'üéâ Successfully subscribed! Thank you for joining us.';
          messageEl.className = 'form-message success';
        }

        // Hide popup after 2 seconds
        setTimeout(() => {
          hidePopup();
        }, 2000);
      } else {
        if (messageEl) {
          messageEl.textContent = data.error || 'Subscription failed. Please try again.';
          messageEl.className = 'form-message error';
        }
      }
    } catch (error) {
      console.error('Subscription error:', error);
      if (messageEl) {
        messageEl.textContent = 'Network error. Please check your connection and try again.';
        messageEl.className = 'form-message error';
      }
    } finally {
      submitBtn.classList.remove('loading');
      submitBtn.disabled = false;
    }
  }

  function handleNotNow() {
    const notNowUntil = Date.now() + CONFIG.notNowDelay;
    localStorage.setItem(STORAGE_KEYS.notNowUntil, notNowUntil.toString());
    hidePopup();
  }

  function handleCancel() {
    localStorage.setItem(STORAGE_KEYS.cancelled, 'true');
    hidePopup();
  }

  // Initialize popup
  document.addEventListener('DOMContentLoaded', () => {
    const popup = document.getElementById('subscription-popup');
    const autoTrigger = popup?.getAttribute('data-auto-trigger') === 'true';
    
    // Schedule popup to show after grace period only if autoTrigger is enabled
    if (autoTrigger) {
      schedulePopup();
    }

    // Event listeners
    const form = document.getElementById('subscription-form');
    const overlay = document.getElementById('popup-overlay');
    const notNowBtn = document.getElementById('not-now-btn');
    const cancelBtn = document.getElementById('cancel-btn');

    if (form) {
      form.addEventListener('submit', handleSubscribe);
    }

    if (overlay) {
      overlay.addEventListener('click', handleNotNow);
    }

    if (notNowBtn) {
      notNowBtn.addEventListener('click', handleNotNow);
    }

    if (cancelBtn) {
      cancelBtn.addEventListener('click', handleCancel);
    }

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      if (popupTimeout) {
        clearTimeout(popupTimeout);
      }
    });
  });
</script> </body></html> 