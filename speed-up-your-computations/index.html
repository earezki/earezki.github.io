<!DOCTYPE html><html lang="en" data-theme="dark"> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Speed Up Your Computations • Dev|Journal</title><meta name="description" content="Sometimes you find yourself trying to squeeze the last bits of your CPU to give you some more milliseconds. Or you may hate the smell of a melting CPU. Or…"><meta property="og:title" content="Speed Up Your Computations • Dev|Journal"><meta property="og:site_name" content="Dev|Journal"><meta property="og:description" content="Sometimes you find yourself trying to squeeze the last bits of your CPU to give you some more milliseconds. Or you may hate the smell of a melting CPU. Or…"><link rel="canonical" href="https://earezki.com/speed-up-your-computations/"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Speed Up Your Computations • Dev|Journal"><meta name="twitter:description" content="Sometimes you find yourself trying to squeeze the last bits of your CPU to give you some more milliseconds. Or you may hate the smell of a melting CPU. Or…"><link rel="alternate" type="application/rss+xml" title="RSS" href="/rss.xml"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-161447264-1"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Speed Up Your Computations","datePublished":"2017-09-11T04:49:46.000Z","dateModified":"2017-09-11T04:49:46.000Z","author":{"@type":"Person","name":"AREZKI El Mehdi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://earezki.com/speed-up-your-computations/"},"description":"Sometimes you find yourself trying to squeeze the last bits of your CPU to give you some more milliseconds. Or you may hate the smell of a melting CPU. Or…"}</script><link rel="stylesheet" href="/_astro/_slug_.CKLbyC1A.css">
<style>.post-layout[data-astro-cid-yvbahnfj]{display:grid;grid-template-columns:260px 1fr;gap:2.5rem}.sidebar-left[data-astro-cid-yvbahnfj]{position:relative}@media (max-width: 1080px){.post-layout[data-astro-cid-yvbahnfj]{grid-template-columns:1fr}}
.toc[data-astro-cid-xvrfupwn]{position:sticky;top:90px;max-height:calc(100vh - 120px);overflow:auto;padding:1rem 1rem 1.2rem;background:var(--color-bg-alt);border:1px solid var(--color-border);border-radius:var(--radius-md);font-size:.8rem;line-height:1.3}.toc-title[data-astro-cid-xvrfupwn]{font-weight:600;font-size:.75rem;text-transform:uppercase;letter-spacing:.08em;margin-bottom:.6rem;color:var(--color-text-alt)}.toc[data-astro-cid-xvrfupwn] ul[data-astro-cid-xvrfupwn]{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:.35rem}.toc[data-astro-cid-xvrfupwn] a[data-astro-cid-xvrfupwn]{text-decoration:none;color:var(--color-text-alt)}.toc[data-astro-cid-xvrfupwn] a[data-astro-cid-xvrfupwn]:hover{color:var(--color-accent)}.toc[data-astro-cid-xvrfupwn] li[data-astro-cid-xvrfupwn][class*=d-3]{margin-left:.75rem}.toc[data-astro-cid-xvrfupwn] li[data-astro-cid-xvrfupwn][class*=d-4]{margin-left:1.4rem}@media (max-width: 1080px){.toc[data-astro-cid-xvrfupwn]{display:none}}
</style><script type="module" src="/_astro/hoisted.CwSnpN4J.js"></script></head> <body> <div id="readingProgress" style="position:fixed;left:0;top:0;height:3px;background:linear-gradient(90deg,#2563eb,#9333ea);width:0;z-index:999;transition:width .15s ease;"></div>  <header class="site-header container"> <div class="logo-wrap"> <a class="logo" href="/">Dev|Journal</a> </div> <nav class="main-nav"> <a href="/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"> <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path> <polyline points="9 22 9 12 15 12 15 22"></polyline> </svg>
Home
</a> <a href="/ai-news/" class="ai-news-link"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"> <path d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h-9.5a.5.5 0 0 0-.5.5.5.5 0 0 1-1 0 .5.5 0 0 0-.5-.5H1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z"></path> <path d="M7 15v4a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2v-4"></path> </svg>
AI News
</a> <a href="/search/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"> <circle cx="11" cy="11" r="8"></circle> <path d="m21 21-4.35-4.35"></path> </svg>
Search
</a> <a href="/tags/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"> <path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2z"></path> <circle cx="7" cy="7" r="1.5"></circle> </svg>
Tags
</a> <a href="/about/"> <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;"> <circle cx="12" cy="12" r="10"></circle> <path d="M12 16v-4"></path> <path d="M12 8h.01"></path> </svg>
About
</a> <button id="themeToggle" class="theme-toggle" aria-label="Toggle dark mode"> <span class="theme-icon">☾</span> <span class="theme-text">dark</span> </button> </nav> </header> <main class="container content-area">  <div class="post-layout" data-astro-cid-yvbahnfj> <aside class="sidebar-left" data-astro-cid-yvbahnfj>  </aside> <article class="post" data-astro-cid-yvbahnfj> <header class="post-header" data-astro-cid-yvbahnfj> <h1 data-astro-cid-yvbahnfj>Speed Up Your Computations</h1> <div class="meta" data-astro-cid-yvbahnfj> <time datetime="2017-09-11T04:49:46.000Z" data-astro-cid-yvbahnfj>Mon Sep 11 2017</time> <span data-astro-cid-yvbahnfj>• 3 min read</span> </div> <div class="tag-row" data-astro-cid-yvbahnfj><a class="tag " href="/tags/performance/" data-astro-cid-yvbahnfj>Performance</a></div> </header> <div class="post-body prose" data-astro-cid-yvbahnfj> <p><img src="/assets/speed_up_your_computations.jpg" alt="Speed Up Your Computations" title="Speed Up Your Computations"></p>
<p>Sometimes you find yourself trying to squeeze the last bits of your CPU to give you some more milliseconds. Or you may hate the smell of a melting CPU. Or maybe you are just a performance maniac. If you happen to be in one of these cases, keep reading this post.</p>
<p>So let us say you are designing a banking application in which you have a Transaction entity, and let us say that the entity contains these simple fields.</p>
<pre class="astro-code github-dark-default" style="background-color:#0d1117;color:#e6edf3; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#FF7B72">public</span><span style="color:#FF7B72"> class</span><span style="color:#FFA657"> Transaction</span><span style="color:#E6EDF3"> {</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> TransactionId</span><span style="color:#E6EDF3"> id;</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> Money</span><span style="color:#E6EDF3"> amount;</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> AccountId</span><span style="color:#E6EDF3"> debit;</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> AccountId</span><span style="color:#E6EDF3"> credit;</span></span>
<span class="line"><span style="color:#E6EDF3">}</span></span>
<span class="line"></span></code></pre>
<p>The Money would, simple holding only the value itself as:</p>
<pre class="astro-code github-dark-default" style="background-color:#0d1117;color:#e6edf3; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#FF7B72">public</span><span style="color:#FF7B72"> class</span><span style="color:#FFA657"> Money</span><span style="color:#E6EDF3"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#FF7B72"> double</span><span style="color:#E6EDF3"> value;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6EDF3">    Money </span><span style="color:#D2A8FF">add</span><span style="color:#E6EDF3">(Money </span><span style="color:#FFA657">other</span><span style="color:#E6EDF3">) {</span></span>
<span class="line"><span style="color:#FF7B72">        return</span><span style="color:#FF7B72"> new</span><span style="color:#D2A8FF"> Money</span><span style="color:#E6EDF3">(value </span><span style="color:#FF7B72">+</span><span style="color:#E6EDF3"> other.value);</span></span>
<span class="line"><span style="color:#E6EDF3">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6EDF3">}</span></span>
<span class="line"></span></code></pre>
<p>And then you have an account with a liste of all the transactions that it has made.</p>
<pre class="astro-code github-dark-default" style="background-color:#0d1117;color:#e6edf3; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#FF7B72">public</span><span style="color:#FF7B72"> class</span><span style="color:#FFA657"> Account</span><span style="color:#E6EDF3"> {</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> AccountId</span><span style="color:#E6EDF3"> id;</span></span>
<span class="line"><span style="color:#E6EDF3">    ...</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> List</span><span style="color:#FFA657">&#x3C;</span><span style="color:#FF7B72">Transaction</span><span style="color:#FFA657">> </span><span style="color:#E6EDF3">transactions;</span></span>
<span class="line"><span style="color:#E6EDF3">    ...</span></span>
<span class="line"><span style="color:#E6EDF3">}</span></span>
<span class="line"></span></code></pre>
<p>Now you are tasked to calculate the total amount of those transactions. A simple functional solution with java 8 streams would be:</p>
<pre class="astro-code github-dark-default" style="background-color:#0d1117;color:#e6edf3; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#FF7B72">public</span><span style="color:#FF7B72"> class</span><span style="color:#FFA657"> Account</span><span style="color:#E6EDF3"> {</span></span>
<span class="line"><span style="color:#E6EDF3">    Money </span><span style="color:#D2A8FF">total</span><span style="color:#E6EDF3">() {</span></span>
<span class="line"><span style="color:#FF7B72">        return</span><span style="color:#E6EDF3"> transactions.</span><span style="color:#D2A8FF">stream</span><span style="color:#E6EDF3">()</span></span>
<span class="line"><span style="color:#E6EDF3">            .</span><span style="color:#D2A8FF">map</span><span style="color:#E6EDF3">(Transaction</span><span style="color:#FF7B72">::</span><span style="color:#E6EDF3">amount)</span></span>
<span class="line"><span style="color:#E6EDF3">            .</span><span style="color:#D2A8FF">reduce</span><span style="color:#E6EDF3">(Money.ZERO, Money</span><span style="color:#FF7B72">::</span><span style="color:#E6EDF3">add);</span></span>
<span class="line"><span style="color:#E6EDF3">    }</span></span>
<span class="line"><span style="color:#E6EDF3">}</span></span>
<span class="line"></span></code></pre>
<p>You test it and it works. The next day, your colleagues start to complain about performance, and given there are millions of transactions, the profiler points to your method.</p>
<p>What are you going to do now? Hmm, let me see, yeah, I got it, parallelism to the rescue. You take this great idea to your colleagues and they turn you down because the server is already filled with active threads. Now what? Well, you just need to better use your cycles (bear the word).</p>
<p>Let’s change the structure of the Transaction entity.</p>
<pre class="astro-code github-dark-default" style="background-color:#0d1117;color:#e6edf3; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#FF7B72">public</span><span style="color:#FF7B72"> class</span><span style="color:#FFA657"> Transactions</span><span style="color:#E6EDF3"> {</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#FF7B72"> TransactionId</span><span style="color:#FFA657">[] </span><span style="color:#E6EDF3">uuid;</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> Moneys</span><span style="color:#E6EDF3"> amount;</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#FF7B72"> AccountId</span><span style="color:#FFA657">[] </span><span style="color:#E6EDF3">debit;</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#FF7B72"> AccountId</span><span style="color:#FFA657">[] </span><span style="color:#E6EDF3">credit;</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#FF7B72"> int</span><span style="color:#E6EDF3"> transactionsCount;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6EDF3">    Money </span><span style="color:#D2A8FF">total</span><span style="color:#E6EDF3">() {</span></span>
<span class="line"><span style="color:#E6EDF3">        Money</span><span style="color:#E6EDF3"> result</span><span style="color:#FF7B72"> =</span><span style="color:#E6EDF3"> Money.ZERO;</span></span>
<span class="line"><span style="color:#E6EDF3">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6EDF3">}</span></span>
<span class="line"></span></code></pre>
<p>Notice the name that is transactions (with an S), and also the entity holds arrays rather than single objects.</p>
<p>Now the Account will hold this new Transactions object instead of the Transaction list.</p>
<p>Then the calculation becomes:</p>
<pre class="astro-code github-dark-default" style="background-color:#0d1117;color:#e6edf3; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#FF7B72">public</span><span style="color:#FF7B72"> class</span><span style="color:#FFA657"> Account</span><span style="color:#E6EDF3"> {</span></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#E6EDF3"> Transactions</span><span style="color:#E6EDF3"> transactions;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6EDF3">    Money </span><span style="color:#D2A8FF">total</span><span style="color:#E6EDF3">() {</span></span>
<span class="line"><span style="color:#FF7B72">       return</span><span style="color:#E6EDF3"> transactions.</span><span style="color:#D2A8FF">total</span><span style="color:#E6EDF3">();</span></span>
<span class="line"><span style="color:#E6EDF3">   }</span></span>
<span class="line"><span style="color:#E6EDF3">} </span></span>
<span class="line"></span></code></pre>
<p>Nothing wrong with this code, always OOP !</p>
<p>We also changed the Amount class, the new object (Amounts) hold an array of values (primitive double array).</p>
<pre class="astro-code github-dark-default" style="background-color:#0d1117;color:#e6edf3; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;" tabindex="0" data-language="java"><code><span class="line"><span style="color:#FF7B72">public</span><span style="color:#FF7B72"> class</span><span style="color:#FFA657"> Moneys</span><span style="color:#E6EDF3"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF7B72">    private</span><span style="color:#FF7B72"> double</span><span style="color:#FFA657">[] </span><span style="color:#E6EDF3">values;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6EDF3">    Money </span><span style="color:#D2A8FF">add</span><span style="color:#E6EDF3">(Money </span><span style="color:#FFA657">other</span><span style="color:#E6EDF3">) {</span></span>
<span class="line"><span style="color:#FF7B72">        double</span><span style="color:#E6EDF3"> result</span><span style="color:#FF7B72"> =</span><span style="color:#79C0FF"> 0</span><span style="color:#E6EDF3">;</span></span>
<span class="line"><span style="color:#FF7B72">        for</span><span style="color:#E6EDF3"> (</span><span style="color:#FF7B72">int</span><span style="color:#E6EDF3"> i</span><span style="color:#FF7B72"> =</span><span style="color:#79C0FF"> 0</span><span style="color:#E6EDF3">; i </span><span style="color:#FF7B72">&#x3C;</span><span style="color:#E6EDF3"> values.length; i</span><span style="color:#FF7B72">++</span><span style="color:#E6EDF3">) {</span></span>
<span class="line"><span style="color:#E6EDF3">            result </span><span style="color:#FF7B72">+=</span><span style="color:#E6EDF3"> value[i];</span></span>
<span class="line"><span style="color:#E6EDF3">        }</span></span>
<span class="line"><span style="color:#FF7B72">        return</span><span style="color:#FF7B72"> new</span><span style="color:#D2A8FF"> Money</span><span style="color:#E6EDF3">(result);</span></span>
<span class="line"><span style="color:#E6EDF3">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E6EDF3">}</span></span>
<span class="line"></span></code></pre>
<p>On my machine and after warming the JVM for a million rounds, this implementation is around 32X faster than the previous one (test the code for yourselves on <a href="https://github.com/earezki/speedup-computations">Github</a>) and share your results).</p>
<p>Now, why this is faster? It turns out that modern CPUs work better when all the calculation is applied on data that is packed together. The CPU reads data from the memory in cache lines (it is around 64KB in most CPUs) and stores it in the L1 cache. When the CPU wants to fetch data, it will compare its address to the address space in the L1 then L2 then L3 caches. If the address is not there, the CPU will read a whole cache line starting from the nearest alignment to the needed address and store it in the L1 cache (in this example, the CPU will load all the attributes of the Transaction to use the amount attribute).</p>
<p>The first example suffers a lot from cache miss, which means the CPU reads a lot of data that it doesn’t need, then throws it away, and then reads more data that it won’t need.</p>
<p>One more advantage is that this approach fits naturally with SIMD operations (Kinda hard to use in java anyway, but the compiler may chose to optimize the code to use it).</p>
<p>To a give an example, the read from the L1 cache in Intel i7 5500 takes around 4 cycles for simple access, whereas a read from main memory takes around 120 cycles.</p>
<p>Now you have it; most of the time, you probably won’t use it, this technique is heavily used in the game development industry, and in embedded systems.</p>
<p>And to make a disclaimer, you may not benefit from this approach in a large web app, because other scheduled threads will pollute the cache anyway, and your best bet is the large shared L3 cache (for Intel, at least).</p> </div> </article> </div> <div class="back-link" data-astro-cid-yvbahnfj><a href="/" data-astro-cid-yvbahnfj>← Back to home</a></div>  </main> <footer class="site-footer container"> <p>© 2025 AREZKI El Mehdi • <a href="https://github.com/earezki">GitHub</a></p> </footer>  </body> </html> 